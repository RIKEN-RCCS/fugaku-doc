
<!DOCTYPE html>

<html lang="ja" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/fugaku/docs/img/favicon.ico">

    <title>1. 概要 &#8212; TAU利用ガイド  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="_static/bizstyle.css?v=5283bb3d" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=89e52957" />
    
    <script src="_static/documentation_options.js?v=c033477b"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/translations.js?v=4755f45a"></script>
    <script src="_static/bizstyle.js"></script>
    <link rel="search" title="検索" href="search.html" />
    <link rel="prev" title="TAU 利用ガイド" href="index.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="index.html" title="TAU 利用ガイド"
             accesskey="P">前へ</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">TAU利用ガイド  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">1. </span>概要</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="id1">
<h1><span class="section-number">1. </span>概要<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h1>
<p>TAU (Tuning and Analysis Utilities) は、C/C++, Fortran, Java, Python, UPCで書かれた並列プログラムの性能解析ツールです <a class="footnote-reference brackets" href="#tau" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>。
ここではスーパーコンピュータ「富岳」で、TAUを利用したプログラムの実行方法を示します。</p>
<p>TAUに関する詳細な情報は、<a class="reference external" href="http://www.cs.uoregon.edu/research/tau/">http://www.cs.uoregon.edu/research/tau/</a> 等を参考にしてください。</p>
</section>
<section id="id3">
<h1><span class="section-number">2. </span>バージョンと注意<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h1>
<p>2024年3月現在、TAUはバージョン2.32.1がインストールされています。インストール先は以下の通りです。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/vol0004/apps/oss/tau
</pre></div>
</div>
<p>TAUを使用するには、インストールされたTAUの環境を呼び出し、mpiexecによりtau_execを実行します。
その時に実行時オプションを渡すことで、TAUに実行プログラムのパフォーマンスを解析させることができます。
例えば以下のオプションにより、プロファイル結果の出力を可能です。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22.2%" />
<col style="width: 77.8%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>オプション</p></th>
<th class="head"><p>効果</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-ebs</p></td>
<td><p>イベントベースサンプリングを有効にする</p></td>
</tr>
<tr class="row-odd"><td><p>-io</p></td>
<td><p>I/Oをトラッキングする</p></td>
</tr>
<tr class="row-even"><td><p>-memory</p></td>
<td><p>メモリをトラッキングする(*)</p></td>
</tr>
</tbody>
</table>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>バージョン2.32.1では、スーパーコンピュータ「富岳」で-memoryオプションを使用すると実行プログラムがハングすることを確認しています。
メモリトラッキングを行いたい場合はこの実行時オプションを使用せず、
同様の効果を持つ環境変数TAU_TRACK_MEMORY_FOOTPRINTを有効にしてください。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">TAU_TRACK_MEMORY_FOOTPRINT</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</div>
<p>簡単にプロファイル結果を表示するには、pprofを使用します。
テキストベースで標準出力に結果が表示されるので、リダイレクトでログファイルに記述するようにすると便利です。</p>
</section>
<section id="id4">
<h1><span class="section-number">3. </span>実行方法<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h1>
<p>ここではTAUを利用したテストプログラムによるスーパーコンピュータ「富岳」での実行方法を示します。</p>
<p>ジョブは以下のような形で記述します。</p>
<p>[実行例]</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /bin/bash -x</span>
<span class="c1">#PJM -L node=1</span>
<span class="c1">#PJM -L elapse=00:10:00</span>
<span class="c1">#PJM -x PJM_LLIO_GFSCACHE=/vol0004</span>
<span class="c1">#PJM --mpi max-proc-per-node=48</span>
<span class="c1">#PJM -g groupname</span>
<span class="c1">#PJM -s</span>
<span class="c1">#</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PARALLEL</span><span class="o">=</span><span class="m">1</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span>

<span class="c1"># TAU</span>
.<span class="w"> </span>/vol0004/apps/oss/tau/setup-env.sh

<span class="c1"># run</span>
mpiexec<span class="w"> </span>tau_exec<span class="w"> </span>-ebs<span class="w"> </span>./test.exe
pprof<span class="w"> </span>-a<span class="w"> </span>&gt;<span class="w"> </span>tau_profile.log
</pre></div>
</div>
<p>実行結果の一例として、pprofで出力されたテキストを示します。
これはI/Oのトラッキング結果の一部です。</p>
<p>[結果例]</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>USER<span class="w"> </span>EVENTS<span class="w"> </span>Profile<span class="w"> </span>:NODE<span class="w"> </span><span class="m">6</span>,<span class="w"> </span>CONTEXT<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>THREAD<span class="w"> </span><span class="m">0</span>
---------------------------------------------------------------------------------------
NumSamples<span class="w">   </span>MaxValue<span class="w">   </span>MinValue<span class="w">  </span>MeanValue<span class="w">  </span>Std.<span class="w"> </span>Dev.<span class="w">  </span>Event<span class="w"> </span>Name
---------------------------------------------------------------------------------------
<span class="w">       </span><span class="m">948</span><span class="w">  </span><span class="m">1</span>.024E+07<span class="w">          </span><span class="m">2</span><span class="w">  </span><span class="m">1</span>.892E+04<span class="w">  </span><span class="m">3</span>.474E+05<span class="w">  </span>Bytes<span class="w"> </span>Read
<span class="w">       </span><span class="m">393</span><span class="w">  </span><span class="m">1</span>.366E+06<span class="w">          </span><span class="m">8</span><span class="w">  </span><span class="m">1</span>.286E+04<span class="w">  </span><span class="m">9</span>.108E+04<span class="w">  </span>Bytes<span class="w"> </span>Read<span class="w"> </span>:<span class="w"> </span><span class="nv">taupreload_main</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>MPI_Finalize<span class="o">()</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>read<span class="o">()</span>
<span class="w">         </span><span class="m">4</span><span class="w">         </span><span class="m">21</span><span class="w">          </span><span class="m">6</span><span class="w">      </span><span class="m">17</span>.25<span class="w">      </span><span class="m">6</span>.495<span class="w">  </span>Bytes<span class="w"> </span>Read<span class="w"> </span>:<span class="w"> </span><span class="nv">taupreload_main</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>MPI_Init<span class="o">()</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>fscanf<span class="o">()</span>
<span class="w">       </span><span class="m">307</span><span class="w">       </span><span class="m">8192</span><span class="w">          </span><span class="m">2</span><span class="w">      </span><span class="m">114</span>.5<span class="w">      </span><span class="m">707</span>.9<span class="w">  </span>Bytes<span class="w"> </span>Read<span class="w"> </span>:<span class="w"> </span><span class="nv">taupreload_main</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>MPI_Init<span class="o">()</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>read<span class="o">()</span>
<span class="w">         </span><span class="m">3</span><span class="w">          </span><span class="m">4</span><span class="w">          </span><span class="m">4</span><span class="w">          </span><span class="m">4</span><span class="w">          </span><span class="m">0</span><span class="w">  </span>Bytes<span class="w"> </span>Read<span class="w"> </span>:<span class="w"> </span><span class="nv">taupreload_main</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>MPI_Init<span class="o">()</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>recv<span class="o">()</span>
<span class="w">       </span><span class="m">235</span><span class="w">  </span><span class="m">1</span>.024E+07<span class="w">          </span><span class="m">2</span><span class="w">  </span><span class="m">5</span>.465E+04<span class="w">  </span><span class="m">6</span>.864E+05<span class="w">  </span>Bytes<span class="w"> </span>Read<span class="w"> </span>:<span class="w"> </span><span class="nv">taupreload_main</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>read<span class="o">()</span>
<span class="w">         </span><span class="m">6</span><span class="w">        </span><span class="m">107</span><span class="w">          </span><span class="m">4</span><span class="w">      </span><span class="m">50</span>.67<span class="w">      </span><span class="m">41</span>.43<span class="w">  </span>Bytes<span class="w"> </span>Read<span class="w"> </span>:<span class="w"> </span><span class="nv">taupreload_main</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>recvfrom<span class="o">()</span>
<span class="w">         </span><span class="m">1</span><span class="w">       </span><span class="m">2902</span><span class="w">       </span><span class="m">2902</span><span class="w">       </span><span class="m">2902</span><span class="w">          </span><span class="m">0</span><span class="w">  </span>Bytes<span class="w"> </span>Read<span class="w"> </span>&lt;<span class="nv">file</span><span class="o">=</span>//etc/opt/FJSVtcs/ple/pmix-mca-params.conf&gt;
<span class="w">         </span><span class="m">1</span><span class="w">       </span><span class="m">2902</span><span class="w">       </span><span class="m">2902</span><span class="w">       </span><span class="m">2902</span><span class="w">          </span><span class="m">0</span><span class="w">  </span>Bytes<span class="w"> </span>Read<span class="w"> </span>&lt;<span class="nv">file</span><span class="o">=</span>//etc/opt/FJSVtcs/ple/pmix-mca-params.conf&gt;<span class="w"> </span>:<span class="w"> </span><span class="nv">taupreload_main</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>MPI_Init<span class="o">()</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>read<span class="o">()</span>
<span class="w">         </span><span class="m">1</span><span class="w">        </span><span class="m">353</span><span class="w">        </span><span class="m">353</span><span class="w">        </span><span class="m">353</span><span class="w">          </span><span class="m">0</span><span class="w">  </span>Bytes<span class="w"> </span>Read<span class="w"> </span>&lt;<span class="nv">file</span><span class="o">=</span>/etc/opt/FJSVtcs/krm/libpxkrm.conf&gt;
<span class="w">         </span><span class="m">1</span><span class="w">        </span><span class="m">353</span><span class="w">        </span><span class="m">353</span><span class="w">        </span><span class="m">353</span><span class="w">          </span><span class="m">0</span><span class="w">  </span>Bytes<span class="w"> </span>Read<span class="w"> </span>&lt;<span class="nv">file</span><span class="o">=</span>/etc/opt/FJSVtcs/krm/libpxkrm.conf&gt;<span class="w"> </span>:<span class="w"> </span><span class="nv">taupreload_main</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>read<span class="o">()</span>
</pre></div>
</div>
<p class="rubric">Footnote</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="tau" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">1</a><span class="fn-bracket">]</span></span>
<ol class="upperalpha simple" start="19">
<li><p>Shende and A. D. Malony, &quot;The TAU Parallel Performance System,&quot; International Journal of High Performance Computing Applications, SAGE Publications, 20(2):287-331, Summer 2006.</p></li>
</ol>
</aside>
</aside>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">1. 概要</a></li>
<li><a class="reference internal" href="#id3">2. バージョンと注意</a></li>
<li><a class="reference internal" href="#id4">3. 実行方法</a></li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="index.html"
                          title="前の章へ">TAU 利用ガイド</a></p>
  </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="index.html" title="TAU 利用ガイド"
             >前へ</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">TAU利用ガイド  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">1. </span>概要</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, 理化学研究所計算科学研究センター.
    &nbsp;&nbsp;<a href="https://www.fugaku.r-ccs.riken.jp/">Fugaku Potal Top</a>
    </div>
  </body>
</html>