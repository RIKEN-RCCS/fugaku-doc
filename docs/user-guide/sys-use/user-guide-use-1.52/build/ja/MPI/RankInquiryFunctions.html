

<!doctype html>

<html lang="ja" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>6.10. ランク問い合わせ関数 &#8212; 利用手引書 利用およびジョブ実行編  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css?v=532c1bf3" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=89e52957" />
    
    <script src="../_static/documentation_options.js?v=c033477b"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=4dbe4bdc"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="6.11. MPI統計情報" href="MPIStatisticalInformation.html" />
    <link rel="prev" title="6.9. 動的プロセス生成（MPI_COMM_SPAWN）" href="DynamicProcessCreation%28MPI_Comm_spawn%29.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="MPIStatisticalInformation.html" title="6.11. MPI統計情報"
             accesskey="N">次へ</a></li>
        <li class="right" >
          <a href="DynamicProcessCreation%28MPI_Comm_spawn%29.html" title="6.9. 動的プロセス生成（MPI_COMM_SPAWN）"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">利用手引書 利用およびジョブ実行編  ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span class="section-number">6. </span>MPIジョブ実行</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6.10. </span>ランク問い合わせ関数</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="rankinquiryfunctionsmpi">
<span id="id1"></span><h1><span class="section-number">6.10. </span>ランク問い合わせ関数<a class="headerlink" href="#rankinquiryfunctionsmpi" title="Link to this heading">¶</a></h1>
<div class="line-block">
<div class="line">MPIプログラムの実行時は、ジョブスクリプトで指定した形状に合わせて、１から３次元のトーラス座標が設定されます。本章ではトーラス座標のことを「論理座標」と呼ぶこととします。</div>
<div class="line">各ランクには論理座標が割り当てられます。</div>
<div class="line">ランクと論理座標の対応を問い合わせる関数を用意しています。各関数の書式についてはマニュアル「MPI使用手引書」の「ランク問い合わせインターフェース」を参照してください。</div>
<div class="line">なお、本関数は動的プロセス生成の中では使用できません。</div>
</div>
<section id="mpi-comm-world">
<h2><span class="section-number">6.10.1. </span>MPI_COMM_WORLD に指定した論理次元数と論理形状問い合わせ機能<a class="headerlink" href="#mpi-comm-world" title="Link to this heading">¶</a></h2>
<p>ジョブ実行時に指定した論理次元数と論理形状とプロセス数により<code class="docutils literal notranslate"><span class="pre">MPI_COMM_WORLD</span></code>が生成されます。関数は、指定した論理次元数、論理形状を得ることができます。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>MPI関数</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FJMPI_TOPOLOGY_GET_DIMENSION</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MPI_COMM_WORLD</span></code>に与えられる次元数を取得する</p></td>
</tr>
<tr class="row-odd"><td><p>FJMPI_TOPOLOGY_GET_SHAPE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MPI_COMM_WORLD</span></code>に与えられるプロセス形状を取得する</p></td>
</tr>
</tbody>
</table>
<nav class="contents local" id="id2">
<ul class="simple">
<li><p><a class="reference internal" href="#fjmpi-topology-get-dimension" id="id9">FJMPI_TOPOLOGY_GET_DIMENSION</a></p></li>
<li><p><a class="reference internal" href="#fjmpi-topology-get-shape" id="id10">FJMPI_TOPOLOGY_GET_SHAPE</a></p></li>
</ul>
</nav>
<section id="fjmpi-topology-get-dimension">
<h3><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">6.10.1.1. </span>FJMPI_TOPOLOGY_GET_DIMENSION</a><a class="headerlink" href="#fjmpi-topology-get-dimension" title="Link to this heading">¶</a></h3>
<p>&lt;書式&gt;</p>
<ul class="simple">
<li><p>C言語書式</p></li>
</ul>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mpi-ext.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">FJMPI_Topology_get_dimension</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">size</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Fortran (USE mpi_f08_ext)書式</p></li>
</ul>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">USE </span><span class="n">mpi_f08_ext</span>
<span class="n">FJMPI_Topology_get_dimension</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">ierror</span><span class="p">)</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">size</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OPTIONAL</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ierror</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Fortran (USE mpi_ext)書式</p></li>
</ul>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">USE </span><span class="n">MPI_EXT</span>
<span class="n">FJMPI_TOPOLOGY_GET_DIMENSION</span><span class="p">(</span><span class="n">SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">IERROR</span><span class="p">)</span>
<span class="kt">INTEGER </span><span class="n">SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">IERROR</span>
</pre></div>
</div>
</div></blockquote>
<dl>
<dt>&lt;説明&gt;</dt><dd><p><code class="docutils literal notranslate"><span class="pre">MPI_INIT</span></code>ルーチンを実行したときに内部的に生成される<code class="docutils literal notranslate"><span class="pre">MPI_COMM_WORLD</span></code>に属するMPIプロセスが配置されたプロセス形状の次元数を返します。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 12.5%" />
<col style="width: 12.5%" />
<col style="width: 62.5%" />
<col style="width: 12.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>型</p></th>
<th class="head"><p>変数</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>IN/OUT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>int <sup>*</sup></p></td>
<td><p>size</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MPI_COMM_WORLD</span></code>のもつプロセス形状の次元数</p></td>
<td><p>OUT</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>&lt;復帰値&gt;</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 44.4%" />
<col style="width: 44.4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>状態</p></th>
<th class="head"><p>復帰値</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>正常時</p></td>
<td><p>FJMPI_SUCCESS</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>異常時</p></td>
<td><p>FJMPI_ERR_TOPOLOGY_INVALID_COMM</p></td>
<td><p>動的生成されたMPIプロセスから本ルーチンが呼び出された場合</p></td>
</tr>
<tr class="row-even"><td><p>異常時</p></td>
<td><p>FJMPI_ERR_TOPOLOGY_NODE_SHARED_JOB</p></td>
<td><div class="line-block">
<div class="line">ジョブ種別がノード共有ジョブの場合</div>
<div class="line">(ノード共有ジョブの詳細については、ジョブ運用ソフトウェアのマニュアルをお読みください)</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&lt;備考&gt;</p>
<blockquote>
<div><p>以下のどちらかの場合、動作は不定となり保証されません。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MPI_INIT</span></code>ルーチンの実行前に本ルーチンが呼び出された</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MPI_FINALIZE</span></code>ルーチンの実行後に本ルーチンが呼び出された</p></li>
</ul>
</div></blockquote>
</section>
<section id="fjmpi-topology-get-shape">
<h3><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">6.10.1.2. </span>FJMPI_TOPOLOGY_GET_SHAPE</a><a class="headerlink" href="#fjmpi-topology-get-shape" title="Link to this heading">¶</a></h3>
<p>&lt;書式&gt;</p>
<ul class="simple">
<li><p>C言語書式</p></li>
</ul>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mpi-ext.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">FJMPI_Topology_get_shape</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Fortran (USE mpi_f08_ext)書式</p></li>
</ul>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">USE </span><span class="n">mpi_f08_ext</span>
<span class="n">FJMPI_Topology_get_shape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">ierror</span><span class="p">)</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OPTIONAL</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ierror</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Fortran (USE mpi_ext)書式</p></li>
</ul>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">USE </span><span class="n">MPI_EXT</span>
<span class="n">FJMPI_TOPOLOGY_GET_SHAPE</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">,</span><span class="w"> </span><span class="n">IERROR</span><span class="p">)</span>
<span class="kt">INTEGER </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">,</span><span class="w"> </span><span class="n">IERROR</span>
</pre></div>
</div>
</div></blockquote>
<dl>
<dt>&lt;説明&gt;</dt><dd><p><code class="docutils literal notranslate"><span class="pre">MPI_INIT</span></code>ルーチンを実行したときに内部的に生成される<code class="docutils literal notranslate"><span class="pre">MPI_COMM_WORLD</span></code>に与えられるMPI並列プロセスの形状XYZを返します。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 11.1%" />
<col style="width: 55.6%" />
<col style="width: 22.2%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>型</p></th>
<th class="head"><p>変数</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>IN/OUT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>int <sup>*</sup></p></td>
<td><p>x</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MPI_COMM_WORLD</span></code>に与えられるプロセス形状のX軸のサイズ</p></td>
<td><p>OUT</p></td>
</tr>
<tr class="row-odd"><td><p>int <sup>*</sup></p></td>
<td><p>y</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MPI_COMM_WORLD</span></code>に与えられるプロセス形状のY軸のサイズ</p></td>
<td><p>OUT</p></td>
</tr>
<tr class="row-even"><td><p>int <sup>*</sup></p></td>
<td><p>z</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MPI_COMM_WORLD</span></code>に与えられるプロセス形状のZ軸のサイズ</p></td>
<td><p>OUT</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>&lt;復帰値&gt;</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 44.4%" />
<col style="width: 44.4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>状態</p></th>
<th class="head"><p>復帰値</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>正常時</p></td>
<td><p>FJMPI_SUCCESS</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>異常時</p></td>
<td><p>FJMPI_ERR_TOPOLOGY_INVALID_COMM</p></td>
<td><p>動的生成されたMPIプロセスから本ルーチンが呼び出された場合</p></td>
</tr>
<tr class="row-even"><td><p>異常時</p></td>
<td><p>FJMPI_ERR_TOPOLOGY_NODE_SHARED_JOB</p></td>
<td><div class="line-block">
<div class="line">ジョブ種別がノード共有ジョブの場合</div>
<div class="line">(ノード共有ジョブの詳細については、ジョブ運用ソフトウェアのマニュアルをお読みください)</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&lt;備考&gt;</p>
<blockquote>
<div><p>プロセス形状が1次元の場合、Y軸およびZ軸の値は0になります。2次元の場合、Z軸の値は0になります。</p>
<p>以下のどちらかの場合、動作は不定となり保証されません。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MPI_INIT</span></code>ルーチンの実行前に本ルーチンが呼び出された</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MPI_FINALIZE</span></code>ルーチンの実行後に本ルーチンが呼び出された</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="mpi">
<h2><span class="section-number">6.10.2. </span>ランク番号によるMPIプログラムの論理座標問い合わせ機能<a class="headerlink" href="#mpi" title="Link to this heading">¶</a></h2>
<p>各ランクごとに論理座標が割り当てられます。関数は、ランク番号から割り当てられている論理座標を得ることができます。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>MPI関数</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FJMPI_TOPOLOGY_GET_COORDS</p></td>
<td><p>ランクから座標を取得する</p></td>
</tr>
</tbody>
</table>
<section id="fjmpi-topology-get-coords">
<h3><span class="section-number">6.10.2.1. </span>FJMPI_TOPOLOGY_GET_COORDS<a class="headerlink" href="#fjmpi-topology-get-coords" title="Link to this heading">¶</a></h3>
<p>&lt;書式&gt;</p>
<ul class="simple">
<li><p>C言語書式</p></li>
</ul>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mpi-ext.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">FJMPI_Topology_get_coords</span><span class="p">(</span><span class="n">MPI_Comm</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxdims</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">coords</span><span class="p">[])</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Fortran (USE mpi_f08_ext)書式</p></li>
</ul>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">USE </span><span class="n">mpi_f08_ext</span>
<span class="n">FJMPI_Topology_get_coords</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="n">maxdims</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="p">,</span><span class="w"> </span><span class="n">ierror</span><span class="p">)</span>
<span class="k">TYPE</span><span class="p">(</span><span class="n">MPI_Comm</span><span class="p">),</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">comm</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="n">maxdims</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">coords</span><span class="p">(</span><span class="n">maxdims</span><span class="p">)</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OPTIONAL</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ierror</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Fortran (USE mpi_ext)書式</p></li>
</ul>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">USE </span><span class="n">MPI_EXT</span>
<span class="n">FJMPI_TOPOLOGY_GET_COORDS</span><span class="p">(</span><span class="n">COMM</span><span class="p">,</span><span class="w"> </span><span class="n">RANK</span><span class="p">,</span><span class="w"> </span><span class="n">VIEW</span><span class="p">,</span><span class="w"> </span><span class="n">MAXDIMS</span><span class="p">,</span><span class="w"> </span><span class="n">COORDS</span><span class="p">,</span><span class="w"> </span><span class="n">IERROR</span><span class="p">)</span>
<span class="kt">INTEGER </span><span class="n">COMM</span><span class="p">,</span><span class="w"> </span><span class="n">RANK</span><span class="p">,</span><span class="w"> </span><span class="n">VIEW</span><span class="p">,</span><span class="w"> </span><span class="n">MAXDIMS</span><span class="p">,</span><span class="w"> </span><span class="n">COORDS</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">IERROR</span>
</pre></div>
</div>
</div></blockquote>
<dl class="simple">
<dt>&lt;説明&gt;</dt><dd><p>指定されたコミュニケータとそのコミュニケータにおけるプロセスのランクに対応する論理座標またはTofu座標を取得します。</p>
</dd>
</dl>
<ul class="simple">
<li><dl class="simple">
<dt>論理座標を取得する場合</dt><dd><p><code class="docutils literal notranslate"><span class="pre">view</span> <span class="pre">=</span> <span class="pre">FJMPI_LOGICAL</span></code>、<code class="docutils literal notranslate"><span class="pre">maxdims</span> <span class="pre">=</span> <span class="pre">1～3</span></code>を指定します。指定した<code class="docutils literal notranslate"><span class="pre">comm</span></code>、<code class="docutils literal notranslate"><span class="pre">rank</span></code>に対応するノードの論理X座標、論理Y座標、論理Z座標の値がそれぞれ coords[0]、coords[1]、coords[2] に格納されます。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Tofu座標(実際に割り当てられた座標)を取得する場合</dt><dd><p><code class="docutils literal notranslate"><span class="pre">view</span> <span class="pre">=</span> <span class="pre">FJMPI_TOFU_SYS</span></code>、<code class="docutils literal notranslate"><span class="pre">maxdims</span> <span class="pre">=</span> <span class="pre">6</span></code>を指定します。指定した<code class="docutils literal notranslate"><span class="pre">comm</span></code>、<code class="docutils literal notranslate"><span class="pre">rank</span></code>に対応するノードのTofu座標のX座標、Y座標、Z座標、A座標、B座標、C座標の値がそれぞれ coords[0]、coords[1]、coords[2]、coords[3]、coords[4]、coords[5] に格納されます。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Tofu座標(引数<code class="docutils literal notranslate"><span class="pre">comm</span></code>のランク0を基準とした相対座標、<code class="docutils literal notranslate"><span class="pre">comm</span></code>がグループ間コミュニケータの場合リモートグループのランク0を基準とした相対座標)を取得する場合</dt><dd><p><code class="docutils literal notranslate"><span class="pre">view</span> <span class="pre">=</span> <span class="pre">FJMPI_TOFU_REL</span></code>、<code class="docutils literal notranslate"><span class="pre">maxdims</span> <span class="pre">=</span> <span class="pre">6</span></code>を指定します。指定した<code class="docutils literal notranslate"><span class="pre">comm</span></code>、<code class="docutils literal notranslate"><span class="pre">rank</span></code>に対応するノードのTofu座標(引数<code class="docutils literal notranslate"><span class="pre">comm</span></code>のランク0を基準とした相対座標)のX座標、Y座標、Z座標、A座標、B座標、C座標の値がそれぞれcoords[0]、coords[1]、coords[2]、coords[3]、coords[4]、coords[5]に格納されます。</p>
</dd>
</dl>
</li>
</ul>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 11.1%" />
<col style="width: 55.6%" />
<col style="width: 22.2%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>型</p></th>
<th class="head"><p>変数</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>IN/OUT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MPI_Comm</p></td>
<td><p>comm</p></td>
<td><p>コミュニケータを指定</p></td>
<td><p>IN</p></td>
</tr>
<tr class="row-odd"><td><p>int</p></td>
<td><p>rank</p></td>
<td><div class="line-block">
<div class="line">コミュニケータ内のランクを指定</div>
<div class="line">引数<code class="docutils literal notranslate"><span class="pre">comm</span></code>にグループ間コミュニケータを指定した場合、リモートグループのランクを指定</div>
</div>
</td>
<td><p>IN</p></td>
</tr>
<tr class="row-even"><td><p>int</p></td>
<td><p>view</p></td>
<td><div class="line-block">
<div class="line">論理座標かTofu座標かを表すマクロを指定</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">FJMPI_LOGICAL</span></code>: 論理座標</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">FJMPI_TOFU_SYS</span></code>: Tofu座標(実際に割り当てられた座標)</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">FJMPI_TOFU_REL</span></code>: Tofu座標(引数<code class="docutils literal notranslate"><span class="pre">comm</span></code>のランク0を基準とした相対座標、<code class="docutils literal notranslate"><span class="pre">comm</span></code>がグループ間コミュニケータの場合リモートグループのランク0を基準とした相対座標)</div>
</div>
</td>
<td><p>IN</p></td>
</tr>
<tr class="row-odd"><td><p>int</p></td>
<td><p>maxdims</p></td>
<td><div class="line-block">
<div class="line">取得する座標の次元数を指定</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">view</span></code>が<code class="docutils literal notranslate"><span class="pre">FJMPI_LOGICAL</span></code>の場合: 1～3を指定</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">view</span></code>が<code class="docutils literal notranslate"><span class="pre">FJMPI_LOGICAL</span></code>以外の場合: 1～6を指定</div>
</div>
</td>
<td><p>IN</p></td>
</tr>
<tr class="row-even"><td><p>int[]</p></td>
<td><p>coords</p></td>
<td><p>コミュニケータとランクに対応する座標の配列</p></td>
<td><p>OUT</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&lt;復帰値&gt;</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 44.4%" />
<col style="width: 44.4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>状態</p></th>
<th class="head"><p>復帰値</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>正常時</p></td>
<td><p>FJMPI_SUCCESS</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>異常時</p></td>
<td><p>FJMPI_ERR_TOPOLOGY_NODE_SHARED_JOB</p></td>
<td><p>ジョブ種別がノード共有ジョブの場合（ノード共有ジョブの詳細については、ジョブ運用ソフトウェアのマニュアルをお読みください）</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&lt;備考&gt;</p>
<ul class="simple">
<li><p>引数<code class="docutils literal notranslate"><span class="pre">coords</span></code>に指定する配列の要素数は、引数<code class="docutils literal notranslate"><span class="pre">maxdims</span></code>以上でなければなりません。</p></li>
<li><p>引数<code class="docutils literal notranslate"><span class="pre">rank</span></code>に指定するランクは、引数<code class="docutils literal notranslate"><span class="pre">comm</span></code>に指定するコミュニケータ内のプロセスが持つランクの範囲内でなければなりません。</p></li>
<li><p>引数<code class="docutils literal notranslate"><span class="pre">view</span></code> に<code class="docutils literal notranslate"><span class="pre">FJMPI_LOGICAL</span></code>を指定した場合、引数<code class="docutils literal notranslate"><span class="pre">maxdims</span></code>の値とジョブ形状が異なっていても構いません。その場合は、2つのうち小さい方の値と同じ次元数分の座標が取得されます。</p></li>
<li><p>以下のどちらかの場合、動作は不定となり保証されません。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">MPI_INIT</span></code>ルーチンの実行前に本ルーチンが呼び出された</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MPI_FINALIZE</span></code>ルーチンの実行後に本ルーチンが呼び出された</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="id3">
<h2><span class="section-number">6.10.3. </span>論理座標によるMPIプログラムのランク番号問い合わせ機能<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>関数は、論理座標から対応するランク番号を得ることができます。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>MPI関数</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FJMPI_TOPOLOGY_GET_RANKS</p></td>
<td><p>座標からランクを取得する</p></td>
</tr>
</tbody>
</table>
<section id="fjmpi-topology-get-ranks">
<h3><span class="section-number">6.10.3.1. </span>FJMPI_TOPOLOGY_GET_RANKS<a class="headerlink" href="#fjmpi-topology-get-ranks" title="Link to this heading">¶</a></h3>
<p>&lt;書式&gt;</p>
<ul class="simple">
<li><p>C言語書式</p></li>
</ul>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mpi-ext.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">FJMPI_Topology_get_ranks</span><span class="p">(</span><span class="n">MPI_Comm</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">coords</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxppn</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">outppn</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ranks</span><span class="p">[])</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Fortran (USE mpi_f08_ext)書式</p></li>
</ul>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">USE </span><span class="n">mpi_f08_ext</span>
<span class="n">FJMPI_Topology_get_ranks</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="p">,</span><span class="w"> </span><span class="n">maxppn</span><span class="p">,</span><span class="w"> </span><span class="n">outppn</span><span class="p">,</span><span class="w"> </span><span class="n">ranks</span><span class="p">,</span><span class="w"> </span><span class="n">ierror</span><span class="p">)</span>
<span class="k">TYPE</span><span class="p">(</span><span class="n">MPI_Comm</span><span class="p">),</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">comm</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">maxppn</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">outppn</span><span class="p">,</span><span class="w"> </span><span class="n">ranks</span><span class="p">(</span><span class="n">maxppn</span><span class="p">)</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OPTIONAL</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ierror</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Fortran (USE mpi_ext)書式</p></li>
</ul>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">USE </span><span class="n">MPI_EXT</span>
<span class="n">FJMPI_TOPOLOGY_GET_RANKS</span><span class="p">(</span><span class="n">COMM</span><span class="p">,</span><span class="w"> </span><span class="n">VIEW</span><span class="p">,</span><span class="w"> </span><span class="n">COORDS</span><span class="p">,</span><span class="w"> </span><span class="n">MAXPPN</span><span class="p">,</span><span class="w"> </span><span class="n">OUTPPN</span><span class="p">,</span><span class="w"> </span><span class="n">RANKS</span><span class="p">,</span><span class="w"> </span><span class="n">IERROR</span><span class="p">)</span>
<span class="kt">INTEGER </span><span class="n">COMM</span><span class="p">,</span><span class="w"> </span><span class="n">VIEW</span><span class="p">,</span><span class="w"> </span><span class="n">COORDS</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">MAXPPN</span><span class="p">,</span><span class="w"> </span><span class="n">OUTPPN</span><span class="p">,</span><span class="w"> </span><span class="n">RANKS</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">IERROR</span>
</pre></div>
</div>
</div></blockquote>
<dl class="simple">
<dt>&lt;説明&gt;</dt><dd><p>指定された論理座標またはTofu座標に存在するプロセスのうち、指定されたコミュニケータに割り当てられているプロセスのランクを取得します。最大で、引数<code class="docutils literal notranslate"><span class="pre">maxppn</span></code>に指定した個数分のプロセスのランクを取得します。実際に取得したランクの個数は、引数<code class="docutils literal notranslate"><span class="pre">outppn</span></code>に格納されます。本ルーチンの利用例を以下に示します。</p>
</dd>
</dl>
<ul class="simple">
<li><dl class="simple">
<dt>論理座標を対象とし、対象の座標に1プロセス存在する場合</dt><dd><p><code class="docutils literal notranslate"><span class="pre">view</span> <span class="pre">=</span> <span class="pre">FJMPI_LOGICAL</span></code>、<code class="docutils literal notranslate"><span class="pre">maxppn</span> <span class="pre">=</span> <span class="pre">1</span></code>以上の値を指定します。また、論理X座標、論理Y座標、論理Z座標の値をそれぞれcoords[0]、coords[1]、coords[2]に指定します。指定した<code class="docutils literal notranslate"><span class="pre">comm</span></code>、<code class="docutils literal notranslate"><span class="pre">coords</span></code>に存在するプロセスのランクが<code class="docutils literal notranslate"><span class="pre">ranks[0]</span></code>に格納されます。<code class="docutils literal notranslate"><span class="pre">outppn</span></code>には、1が格納されます。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Tofu座標を対象とし、対象の座標に4プロセス存在する場合</dt><dd><p><code class="docutils literal notranslate"><span class="pre">view</span> <span class="pre">=</span> <span class="pre">FJMPI_TOFU_SYS</span></code>または<code class="docutils literal notranslate"><span class="pre">FJMPI_TOFU_REL</span></code>、<code class="docutils literal notranslate"><span class="pre">maxppn</span> <span class="pre">=</span> <span class="pre">4</span></code>以上の値を指定します。また、Tofu座標のX座標、Y座標、Z座標、A座標、B座標、C座標の値をそれぞれcoords[0]、coords[1]、coords[2]、coords[3]、coords[4]、coords[5]に指定します。指定した<code class="docutils literal notranslate"><span class="pre">comm、coords</span></code>に存在するプロセスのランクがranks[0]、ranks[1]、ranks[2]、ranks[3]に格納されます。<code class="docutils literal notranslate"><span class="pre">outppn</span></code>には、4が格納されます。</p>
</dd>
</dl>
</li>
</ul>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 70.0%" />
<col style="width: 10.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>型</p></th>
<th class="head"><p>変数</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>IN/OUT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MPI_Comm</p></td>
<td><p>comm</p></td>
<td><p>コミュニケータを指定</p></td>
<td><p>IN</p></td>
</tr>
<tr class="row-odd"><td><p>int</p></td>
<td><p>view</p></td>
<td><div class="line-block">
<div class="line">論理座標かTofu座標かを表すマクロを指定</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">FJMPI_LOGICAL</span></code>: 論理座標</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">FJMPI_TOFU_SYS</span></code>:Tofu座標(実際に割り当てられた座標)</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">FJMPI_TOFU_REL</span></code>:Tofu座標(引数<code class="docutils literal notranslate"><span class="pre">comm</span></code>のランク0を基準とした相対座標、<code class="docutils literal notranslate"><span class="pre">comm</span></code>がグループ間コミュニケータの場合リモートグループのランク0を基準とした相対座標)</div>
</div>
</td>
<td><p>IN</p></td>
</tr>
<tr class="row-even"><td><p>int[]</p></td>
<td><p>coords</p></td>
<td><p>取得するランクのプロセスが割り当てられている座標の値を指定</p></td>
<td><p>IN</p></td>
</tr>
<tr class="row-odd"><td><p>int</p></td>
<td><p>maxppn</p></td>
<td><p>ランクを取得する最大のプロセス数を指定</p></td>
<td><p>IN</p></td>
</tr>
<tr class="row-even"><td><p>int <sup>*</sup></p></td>
<td><p>outppn</p></td>
<td><p>ランクを取得したプロセス数</p></td>
<td><p>OUT</p></td>
</tr>
<tr class="row-odd"><td><p>int[]</p></td>
<td><p>ranks</p></td>
<td><div class="line-block">
<div class="line">取得したランクを格納した配列</div>
<div class="line">グループ間コミュニケータを指定した場合は、リモートグループのランクを格納</div>
</div>
</td>
<td><p>OUT</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&lt;復帰値&gt;</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 44.4%" />
<col style="width: 44.4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>状態</p></th>
<th class="head"><p>復帰値</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>正常時</p></td>
<td><p>FJMPI_SUCCESS</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>異常時</p></td>
<td><p>FJMPI_ERR_TOPOLOGY_NO_PROCESS</p></td>
<td><p>指定した座標に並列プロセスが配置されていない場合</p></td>
</tr>
<tr class="row-even"><td><p>異常時</p></td>
<td><p>FJMPI_ERR_TOPOLOGY_NODE_SHARED_JOB</p></td>
<td><p>ジョブ種別がノード共有ジョブの場合</p>
<p>ノード共有ジョブの詳細については、ジョブ運用ソフトウェアのマニュアルを参照してください。</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>&lt;備考&gt;</p>
<ul class="simple">
<li><p>引数<code class="docutils literal notranslate"><span class="pre">coords</span></code>は、引数<code class="docutils literal notranslate"><span class="pre">view</span></code>に<code class="docutils literal notranslate"><span class="pre">FJMPI_LOGICAL</span></code>を指定した場合、ジョブと同じ次元数の要素分、値を設定する必要があります。引数<code class="docutils literal notranslate"><span class="pre">view</span></code>に<code class="docutils literal notranslate"><span class="pre">FJMPI_TOFU_SYS</span></code>または<code class="docutils literal notranslate"><span class="pre">FJMPI_TOFU_REL</span></code>を指定した場合は、6要素分、値を設定する必要があります。正しく設定されていない場合の動作は不定となり保証されません。</p></li>
<li><p>引数<code class="docutils literal notranslate"><span class="pre">coords</span></code>に指定した座標に存在する、実際のプロセス数を取得するためには、引数<code class="docutils literal notranslate"><span class="pre">maxppn</span></code>の値を大きくした状態で本ルーチンを実行し、引数<code class="docutils literal notranslate"><span class="pre">outppn</span></code>の値を参照します。</p></li>
<li><p>実際に存在するプロセスの数によっては、引数<code class="docutils literal notranslate"><span class="pre">maxppn</span></code>に指定した値よりも引数<code class="docutils literal notranslate"><span class="pre">outppn</span></code>に格納される値の方が小さくなります。この場合は、<code class="docutils literal notranslate"><span class="pre">outppn</span></code>の値と同じ要素数分だけ、引数<code class="docutils literal notranslate"><span class="pre">ranks</span></code>に指定した配列内の値が更新されます。</p></li>
<li><p>以下のどちらかの場合、動作は不定となり保証されません。</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MPI_INIT</span></code> ルーチンの実行前に本ルーチンが呼び出された</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MPI_FINALIZE</span></code> ルーチンの実行後に本ルーチンが呼び出された</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="id4">
<h2><span class="section-number">6.10.4. </span>関数使用例<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p>関数の使用例として、ランクから論理座標とTofu座標を調べる例を示します。</p>
<p>【サンプルプログラム（C）】</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mpi.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mpi-ext.h&gt;</span><span class="c1">              // ヘッダファイルをインクルード</span>
<span class="cp">#define LDIM 3</span>
<span class="cp">#define TDIM 6</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">myrank</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">mydimension</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">coords</span><span class="p">[</span><span class="n">LDIM</span><span class="p">],</span><span class="w"> </span><span class="n">tcoords</span><span class="p">[</span><span class="n">TDIM</span><span class="p">];</span>

<span class="w">  </span><span class="n">MPI_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>
<span class="w">  </span><span class="n">MPI_Comm_size</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>
<span class="w">  </span><span class="n">MPI_Comm_rank</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">myrank</span><span class="p">);</span>

<span class="w">  </span><span class="n">FJMPI_Topology_get_dimension</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mydimension</span><span class="p">);</span>
<span class="w">  </span><span class="n">FJMPI_Topology_get_shape</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">z</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">myrank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;My Dimension= %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">mydimension</span><span class="p">);</span>
<span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;My Shape: X= %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;, Y= %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;, Z= %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">       </span><span class="n">FJMPI_Topology_get_coords</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">FJMPI_LOGICAL</span><span class="p">,</span><span class="w"> </span><span class="n">mydimension</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="p">);</span>
<span class="w">       </span><span class="n">FJMPI_Topology_get_coords</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">FJMPI_TOFU_SYS</span><span class="p">,</span><span class="w"> </span><span class="n">TDIM</span><span class="p">,</span><span class="w"> </span><span class="n">tcoords</span><span class="p">);</span>
<span class="w">       </span><span class="k">switch</span><span class="p">(</span><span class="n">mydimension</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;rank to x : rank= %d, (X)=( %d ) &quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;rank to xy : rank= %d, (X,Y)=( %d, %d ) &quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;rank to xyz : rank= %d, (X,Y,Z)=( %d, %d, %d ) &quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">default</span><span class="o">:</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(x,y,z,a,b,c)=(&quot;</span><span class="p">);</span>
<span class="w">       </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">TDIM</span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">tcoords</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
<span class="w">       </span><span class="p">}</span>
<span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">tcoords</span><span class="p">[</span><span class="n">TDIM</span><span class="mi">-1</span><span class="p">]);</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">MPI_Finalize</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<nav class="contents local" id="id5">
<ul class="simple">
<li><p><a class="reference internal" href="#id6" id="id11">実行例（1次元）</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id12">実行例（2次元）</a></p></li>
<li><p><a class="reference internal" href="#id8" id="id13">実行例（3次元）</a></p></li>
</ul>
</nav>
<section id="id6">
<h3><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">6.10.4.1. </span>実行例（1次元）</a><a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p>サンプルプログラムを1次元形状で実行する際のジョブスクリプトおよび実行結果の例を示します。</p>
<p>【ジョブスクリプト】</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -x</span>
<span class="c1">#</span>
<span class="c1">#PJM -L &quot;node=12&quot;               # 1次元の形状を指定</span>
<span class="c1">#PJM -L &quot;elapse=01:00:00&quot;</span>
<span class="c1">#PJM -g groupname</span>
<span class="c1">#PJM -x PJM_LLIO_GFSCACHE=/vol000N</span>
<span class="c1">#PJM -s</span>
<span class="c1">#</span>
mpiexec<span class="w"> </span>./a.out
</pre></div>
</div>
</div></blockquote>
<p>【出力結果】</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>My Dimension= 1
My Shape: X= 12

rank to x : rank= 0, (X)=( 0 ) (x,y,z,a,b,c)=(18,19,19,0,1,1)
rank to x : rank= 1, (X)=( 1 ) (x,y,z,a,b,c)=(18,19,19,0,2,1)
rank to x : rank= 2, (X)=( 2 ) (x,y,z,a,b,c)=(18,19,19,1,1,1)
rank to x : rank= 3, (X)=( 3 ) (x,y,z,a,b,c)=(18,19,19,1,2,1)
rank to x : rank= 4, (X)=( 4 ) (x,y,z,a,b,c)=(19,19,19,0,1,0)
rank to x : rank= 5, (X)=( 5 ) (x,y,z,a,b,c)=(19,19,19,0,2,1)
rank to x : rank= 6, (X)=( 6 ) (x,y,z,a,b,c)=(19,19,19,1,0,0)
rank to x : rank= 7, (X)=( 7 ) (x,y,z,a,b,c)=(19,19,19,1,1,0)
rank to x : rank= 8, (X)=( 8 ) (x,y,z,a,b,c)=(19,19,19,1,2,1)
rank to x : rank= 9, (X)=( 9 ) (x,y,z,a,b,c)=(20,19,19,0,0,0)
rank to x : rank= 10, (X)=( 10 ) (x,y,z,a,b,c)=(20,19,19,0,1,0)
rank to x : rank= 11, (X)=( 11 ) (x,y,z,a,b,c)=(20,19,19,1,1,0)
</pre></div>
</div>
</div></blockquote>
</section>
<section id="id7">
<h3><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">6.10.4.2. </span>実行例（2次元）</a><a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p>サンプルプログラムを2次元形状で実行する際のジョブスクリプトおよび実行結果の例を示します。</p>
<p>【ジョブスクリプト】</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -x</span>
<span class="c1">#</span>
<span class="c1">#PJM -L &quot;node=4x3&quot;              # 2次元の形状を指定</span>
<span class="c1">#PJM -L &quot;elapse=01:00:00&quot;</span>
<span class="c1">#PJM -g groupname</span>
<span class="c1">#PJM -x PJM_LLIO_GFSCACHE=/vol000N</span>
<span class="c1">#PJM -s</span>
<span class="c1">#</span>
mpiexec<span class="w"> </span>./a.out
</pre></div>
</div>
</div></blockquote>
<p>【出力結果】</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>My Dimension= 2
My Shape: X= 4, Y= 3

rank to xy : rank= 0, (X,Y)=( 0, 0 ) (x,y,z,a,b,c)=(14,21,19,0,0,0)
rank to xy : rank= 1, (X,Y)=( 1, 0 ) (x,y,z,a,b,c)=(14,21,19,0,1,1)
rank to xy : rank= 2, (X,Y)=( 2, 0 ) (x,y,z,a,b,c)=(14,21,19,1,0,0)
rank to xy : rank= 3, (X,Y)=( 3, 0 ) (x,y,z,a,b,c)=(14,21,19,1,1,1)
rank to xy : rank= 4, (X,Y)=( 0, 1 ) (x,y,z,a,b,c)=(14,21,19,0,0,1)
rank to xy : rank= 5, (X,Y)=( 1, 1 ) (x,y,z,a,b,c)=(14,21,19,0,2,0)
rank to xy : rank= 6, (X,Y)=( 2, 1 ) (x,y,z,a,b,c)=(14,21,19,1,0,1)
rank to xy : rank= 7, (X,Y)=( 3, 1 ) (x,y,z,a,b,c)=(14,21,19,1,2,0)
rank to xy : rank= 8, (X,Y)=( 0, 2 ) (x,y,z,a,b,c)=(14,21,19,0,1,0)
rank to xy : rank= 9, (X,Y)=( 1, 2 ) (x,y,z,a,b,c)=(14,21,19,0,2,1)
rank to xy : rank= 10, (X,Y)=( 2, 2 ) (x,y,z,a,b,c)=(14,21,19,1,1,0)
rank to xy : rank= 11, (X,Y)=( 3, 2 ) (x,y,z,a,b,c)=(14,21,19,1,2,1)
</pre></div>
</div>
</div></blockquote>
</section>
<section id="id8">
<h3><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">6.10.4.3. </span>実行例（3次元）</a><a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<p>サンプルプログラムを3次元形状で実行する際のジョブスクリプトおよび実行結果の例を示します。</p>
<p>【ジョブスクリプト】</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -x</span>
<span class="c1">#</span>
<span class="c1">#PJM -L &quot;node=2x3x2&quot;            # 3次元の形状を指定</span>
<span class="c1">#PJM -L &quot;elapse=01:00:00&quot;</span>
<span class="c1">#PJM -g groupname</span>
<span class="c1">#PJM -x PJM_LLIO_GFSCACHE=/vol000N</span>
<span class="c1">#PJM -s</span>
<span class="c1">#</span>
mpiexec<span class="w"> </span>./a.out
</pre></div>
</div>
</div></blockquote>
<p>【出力結果】</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>My Dimension= 3
My Shape: X= 2, Y= 3, Z= 2

rank to xyz : rank= 0, (X,Y,Z)=( 0, 0, 0 ) (x,y,z,a,b,c)=(16,17,18,0,0,0)
rank to xyz : rank= 1, (X,Y,Z)=( 1, 0, 0 ) (x,y,z,a,b,c)=(16,17,18,1,1,0)
rank to xyz : rank= 2, (X,Y,Z)=( 0, 1, 0 ) (x,y,z,a,b,c)=(16,17,18,0,1,0)
rank to xyz : rank= 3, (X,Y,Z)=( 1, 1, 0 ) (x,y,z,a,b,c)=(17,17,18,0,0,0)
rank to xyz : rank= 4, (X,Y,Z)=( 0, 2, 0 ) (x,y,z,a,b,c)=(16,17,18,1,0,0)
rank to xyz : rank= 5, (X,Y,Z)=( 1, 2, 0 ) (x,y,z,a,b,c)=(17,17,18,1,0,0)
rank to xyz : rank= 6, (X,Y,Z)=( 0, 0, 1 ) (x,y,z,a,b,c)=(16,17,18,0,0,1)
rank to xyz : rank= 7, (X,Y,Z)=( 1, 0, 1 ) (x,y,z,a,b,c)=(16,17,18,1,2,0)
rank to xyz : rank= 8, (X,Y,Z)=( 0, 1, 1 ) (x,y,z,a,b,c)=(16,17,18,0,2,0)
rank to xyz : rank= 9, (X,Y,Z)=( 1, 1, 1 ) (x,y,z,a,b,c)=(17,17,18,0,1,0)
rank to xyz : rank= 10, (X,Y,Z)=( 0, 2, 1 ) (x,y,z,a,b,c)=(16,17,18,1,0,1)
rank to xyz : rank= 11, (X,Y,Z)=( 1, 2, 1 ) (x,y,z,a,b,c)=(17,17,18,1,1,0)
</pre></div>
</div>
</div></blockquote>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">6.10. ランク問い合わせ関数</a><ul>
<li><a class="reference internal" href="#mpi-comm-world">6.10.1. MPI_COMM_WORLD に指定した論理次元数と論理形状問い合わせ機能</a><ul>
<li><a class="reference internal" href="#fjmpi-topology-get-dimension">6.10.1.1. FJMPI_TOPOLOGY_GET_DIMENSION</a></li>
<li><a class="reference internal" href="#fjmpi-topology-get-shape">6.10.1.2. FJMPI_TOPOLOGY_GET_SHAPE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mpi">6.10.2. ランク番号によるMPIプログラムの論理座標問い合わせ機能</a><ul>
<li><a class="reference internal" href="#fjmpi-topology-get-coords">6.10.2.1. FJMPI_TOPOLOGY_GET_COORDS</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3">6.10.3. 論理座標によるMPIプログラムのランク番号問い合わせ機能</a><ul>
<li><a class="reference internal" href="#fjmpi-topology-get-ranks">6.10.3.1. FJMPI_TOPOLOGY_GET_RANKS</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4">6.10.4. 関数使用例</a><ul>
<li><a class="reference internal" href="#id6">6.10.4.1. 実行例（1次元）</a></li>
<li><a class="reference internal" href="#id7">6.10.4.2. 実行例（2次元）</a></li>
<li><a class="reference internal" href="#id8">6.10.4.3. 実行例（3次元）</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="DynamicProcessCreation%28MPI_Comm_spawn%29.html"
                          title="前の章へ"><span class="section-number">6.9. </span>動的プロセス生成（MPI_COMM_SPAWN）</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="MPIStatisticalInformation.html"
                          title="次の章へ"><span class="section-number">6.11. </span>MPI統計情報</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="MPIStatisticalInformation.html" title="6.11. MPI統計情報"
             >次へ</a></li>
        <li class="right" >
          <a href="DynamicProcessCreation%28MPI_Comm_spawn%29.html" title="6.9. 動的プロセス生成（MPI_COMM_SPAWN）"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">利用手引書 利用およびジョブ実行編  ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" ><span class="section-number">6. </span>MPIジョブ実行</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6.10. </span>ランク問い合わせ関数</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2025, 理化学研究所計算科学研究センター.
    &nbsp;&nbsp;<a href="https://www.fugaku.r-ccs.riken.jp/">Fugaku website Top</a>
    </div>
  </body>
</html>