

<!doctype html>

<html lang="ja" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>6.11. MPI統計情報 &#8212; 利用手引書 利用およびジョブ実行編  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css?v=532c1bf3" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=89e52957" />
    
    <script src="../_static/documentation_options.js?v=c033477b"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=4dbe4bdc"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="6.12. MPIの集団通信アルゴリズム（knomial, rabenseifner）" href="CollectiveCommunicationAlgorithm.html" />
    <link rel="prev" title="6.10. ランク問い合わせ関数" href="RankInquiryFunctions.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="CollectiveCommunicationAlgorithm.html" title="6.12. MPIの集団通信アルゴリズム（knomial, rabenseifner）"
             accesskey="N">次へ</a></li>
        <li class="right" >
          <a href="RankInquiryFunctions.html" title="6.10. ランク問い合わせ関数"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">利用手引書 利用およびジョブ実行編  ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span class="section-number">6. </span>MPIジョブ実行</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6.11. </span>MPI統計情報</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="mpi">
<h1><span class="section-number">6.11. </span>MPI統計情報<a class="headerlink" href="#mpi" title="Link to this heading">¶</a></h1>
<p>ジョブスクリプトの中で、以下の表に示すMCAパラメータを指定することで、MPI通信に関する統計情報を表示することができます。
MPI統計情報の詳細については、「MPI使用手引書」-「6.15 MPI統計情報」を参照してください。</p>
<ul class="simple">
<li><p>-mca mpi_print_stats</p></li>
<li><p>-mca mpi_print_stats_ranks</p></li>
</ul>
<p>[mpi_print_stats]</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16.7%" />
<col style="width: 8.3%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>範囲</p></th>
<th class="head"><p>値</p></th>
<th class="head"><p>指定内容</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>なし</p></td>
<td><p>0</p></td>
<td><p>MPI統計情報を出力しないことを指定します。本パラメーターに値0から4の整数値以外の値を指定した場合、値0が指定されたものとみなされます。本パラメーターの省略値は0です。</p></td>
</tr>
<tr class="row-odd"><td><p>全体モード</p></td>
<td><p>1</p></td>
<td><p>MPI統計情報を標準エラー出力に出力することを指定します。ただし、この場合、すべての並列プロセスのMPI統計情報が総括され、MPI_COMM_WORLDに属するランク番号が 0 の並列プロセスによって出力されます。</p></td>
</tr>
<tr class="row-even"><td><p>全体モード</p></td>
<td><p>2</p></td>
<td><p>MPI統計情報を標準エラー出力に出力することを指定します。ただし、この場合、並列プロセスごとのMPI統計情報が、それぞれの並列プロセス自身によって出力されます。どの並列プロセスを出力対象とするかは、MCAパラメーター<code class="docutils literal notranslate"><span class="pre">mpi_print_stats_ranks</span></code>によって指定することができます。</p></td>
</tr>
<tr class="row-odd"><td><p>区間モード</p></td>
<td><p>3</p></td>
<td><p>パラメーター値1と同様です。ただし、標準エラー出力に出力させるためにはFJMPI_COLLECTION_PRINTルーチンの指定が必要です。更に出力内容は、ヘッダー部、section行を含めたボディー部、フッター部に分けて出力されます。</p></td>
</tr>
<tr class="row-even"><td><p>区間モード</p></td>
<td><p>4</p></td>
<td><p>パラメーター値2と同様です。ただし、標準エラー出力に出力させるためにはFJMPI_COLLECTION_PRINTルーチンの指定が必要です。更に出力内容は、ヘッダー部、section行を含めたボディー部、フッター部に分けて出力されます。</p></td>
</tr>
</tbody>
</table>
<p>[mpi_print_stats_ranks]</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>値</p></th>
<th class="head"><p>指定内容</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0 以上の整数値</p></td>
<td><p>MPI統計情報を出力する並列プロセスのランク番号を特定します。本MCAパラメーターは、MCAパラメーター<code class="docutils literal notranslate"><span class="pre">mpi_print_stats</span></code>に、2または4を指定した場合にだけ有効となります。MPI_COMM_WORLDに属するランク番号を指定してください。コンマ&quot;,&quot;でランク番号を区切ることで、複数のランク番号を指定することもできます。 本パラメーターに存在しないランク番号を指定した場合、そのランク番号の指定は無視されます。</p></td>
</tr>
<tr class="row-odd"><td><p>-1</p></td>
<td><p>すべての並列プロセスのMPI統計情報を出力することを指定します。 本MCAパラメーターは、MCAパラメーター<code class="docutils literal notranslate"><span class="pre">mpi_print_stats</span></code>に、2または4を指定した場合にだけ有効となります。本パラメーターに-1より小さい値を指定した場合、-1が指定されたものとみなされます。本パラメーターの省略値は-1です。</p></td>
</tr>
</tbody>
</table>
<section id="id1">
<h2><span class="section-number">6.11.1. </span>全体モード<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<p>MPIアプリケーション全体の統計情報を収集し出力します。</p>
<p>MCAオプション<code class="docutils literal notranslate"><span class="pre">mpi_print_stats</span></code>に、<code class="docutils literal notranslate"><span class="pre">1</span></code>、または、<code class="docutils literal notranslate"><span class="pre">2</span></code>を指定することで利用できます。</p>
<p>【オプション指定例】</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mpiexec<span class="w"> </span>-n<span class="w"> </span><span class="m">16</span><span class="w"> </span>-mca<span class="w"> </span>mpi_print_stats<span class="w"> </span><span class="m">1</span><span class="w"> </span>./a.out
</pre></div>
</div>
</section>
<section id="id2">
<h2><span class="section-number">6.11.2. </span>区間モード<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>MCAオプション<code class="docutils literal notranslate"><span class="pre">mpi_print_stats</span></code>に、<code class="docutils literal notranslate"><span class="pre">3</span></code>、または、<code class="docutils literal notranslate"><span class="pre">4</span></code>を指定し、後述の区間指定ルーチンを併用することで利用できます。</p>
<p>MPIアプリケーションの中で、ユーザが範囲指定した区間の統計情報を収集し出力します。</p>
<p>【オプション指定例】</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mpiexec<span class="w"> </span>-n<span class="w"> </span><span class="m">16</span><span class="w"> </span>-mca<span class="w"> </span>mpi_print_stats<span class="w"> </span><span class="m">3</span><span class="w"> </span>./a.out
</pre></div>
</div>
<nav class="contents local" id="id3">
<ul class="simple">
<li><p><a class="reference internal" href="#id4" id="id8">区間指定ルーチン</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id9">区間モードの応用例</a></p></li>
<li><p><a class="reference internal" href="#id6" id="id10">区間モードの出力内容</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id11">区間モード使用時の留意事項</a></p></li>
</ul>
</nav>
<section id="id4">
<h3><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">6.11.2.1. </span>区間指定ルーチン</a><a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
<p>区間指定MPI統計情報インターフェースについて、具体的なルーチンの一覧を以下の表に示します。区間モードを利用する場合は、ソースコードに測定区間の指定（FJMPI_COLLECTION_START/ FJMPI_COLLECTION_STOP）と出力指定（FJMPI_COLLECTION_PRINT）を行う必要があります。</p>
<p>本インターフェースを利用するには、MCAオプション<code class="docutils literal notranslate"><span class="pre">mpi_print_stats</span></code>に、3または4を指定する必要があります。</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 10.0%" />
<col style="width: 50.0%" />
<col style="width: 10.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ルーチン名</p></th>
<th class="head"><p>引数</p></th>
<th class="head"><p>機能概要</p></th>
<th class="head"><p>同期処理</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FJMPI_COLLECTION_START</p></td>
<td><p>なし</p></td>
<td><p>区間指定MPI統計情報の採取開始</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>FJMPI_COLLECTION_STOP</p></td>
<td><p>なし</p></td>
<td><p>区間指定MPI統計情報の採取停止</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>FJMPI_COLLECTION_PRINT</p></td>
<td><p>文字列型</p></td>
<td><p>区間指定MPI統計情報の採取データ出力</p></td>
<td><p><sup>*</sup>1</p></td>
</tr>
<tr class="row-odd"><td><p>FJMPI_COLLECTION_CLEAR</p></td>
<td><p>なし</p></td>
<td><p>区間指定MPI統計情報の採取データ初期化</p></td>
<td><p>-</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">注釈</p>
<p><sup>*</sup>1：mpi_print_stats が3のときのみ、FJMPI_COLLECTION_PRINT内部で、同期処理が入ります。</p>
</div>
</div></blockquote>
<p>区間指定ルーチンの詳細はマニュアル「MPI使用手引書」の「区間指定MPI統計情報インターフェース仕様」を参照してください。</p>
<div class="line-block">
<div class="line">区間指定MPIルーチンの使用イメージを以下の区間指定MPIルーチン使用イメージに示します。</div>
<div class="line">測定区間の指定（FJMPI_Collection_start / FJMPI_Collection_stop）した区間が繰り返し実行される場合、測定値は累積されます。測定値をクリアして測定を行うにはFJMPI_Collection_clearを実行する必要があります。</div>
</div>
<div class="line-block">
<div class="line">以下の区間指定MPIルーチン使用イメージで、9行目のFJMPI_Collection_clearが無かった場合は15行目のFJMPI_Collection_printで処理１と処理２の累積した値が出力されます。</div>
<div class="line"><br /></div>
</div>
<blockquote>
<div><p>[区間指定MPIルーチン使用イメージ]</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">MPI_Init</span><span class="p">();</span>
<span class="linenos"> 2</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="linenos"> 3</span><span class="w">   </span><span class="n">FJMPI_Collection_start</span><span class="p">();</span>
<span class="linenos"> 4</span><span class="w">   </span><span class="c1">//(処理1)</span>
<span class="linenos"> 5</span><span class="w">   </span><span class="n">FJMPI_Collection_stop</span><span class="p">();</span>
<span class="linenos"> 6</span><span class="p">}</span>
<span class="linenos"> 7</span><span class="n">FJMPI_Collection_print</span><span class="p">(</span><span class="s">&quot;main1&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// for文内部の処理1の合計値が出力されます</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="n">FJMPI_Collection_clear</span><span class="p">();</span><span class="w">         </span><span class="c1">// 統計情報を初期化します</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">FJMPI_Collection_start</span><span class="p">();</span>
<span class="linenos">12</span><span class="c1">//(処理2)</span>
<span class="linenos">13</span><span class="n">FJMPI_Collection_stop</span><span class="p">();</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="n">FJMPI_Collection_print</span><span class="p">(</span><span class="s">&quot;main2&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// 12行目の処理2の統計情報が出力されます</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="n">MPI_Finalize</span><span class="p">();</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">測定区間の指定（FJMPI_COLLECTION_START/ FJMPI_COLLECTION_STOP）は入れ子にできません。</div>
<div class="line">入れ子の状態で指定されていた場合は、出力される結果を保証しません。指定時に留意ください。</div>
</div>
<div class="line-block">
<div class="line">入れ子に指定してしまった場合の動作例を以下に示します。</div>
<div class="line">FJMPI_Collection_startが連続した場合、2回目以降は開始時間のみがリセットされます。</div>
<div class="line">FJMPI_Collection_stopが連続した場合、1回目でデータ採取を停止し2回目以降は何もしません。</div>
<div class="line">この結果、8行目のFJMPI_Collection_printでは、Timeは3行目から5行目が、その他（Time以外）の統計情報には1行目から5行目の統計情報が表示されます。</div>
</div>
<blockquote>
<div><p>[測定区間の指定を入れ子にした例]</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="n">FJMPI_Collection_start</span><span class="p">();</span>
<span class="linenos">2</span><span class="w"> </span><span class="c1">//(処理1)</span>
<span class="linenos">3</span><span class="w"> </span><span class="n">FJMPI_Collection_start</span><span class="p">();</span><span class="w">   </span><span class="c1">// 注釈 *1</span>
<span class="linenos">4</span><span class="w"> </span><span class="c1">//(処理2)</span>
<span class="linenos">5</span><span class="w"> </span><span class="n">FJMPI_Collection_stop</span><span class="p">();</span><span class="w">    </span><span class="c1">// 注釈 *2</span>
<span class="linenos">6</span><span class="w"> </span><span class="c1">//(処理3)</span>
<span class="linenos">7</span><span class="w"> </span><span class="n">FJMPI_Collection_stop</span><span class="p">();</span><span class="w">    </span><span class="c1">// 注釈 *3</span>
<span class="linenos">8</span><span class="w"> </span><span class="n">FJMPI_Collection_print</span><span class="p">(</span><span class="s">&quot;s1&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><sup>*</sup>1：出力関数で表示されるTimeの計算に使われる開始時刻だけがリセットされます。カウンタの値はそのまま継続されます。</p>
<p><sup>*</sup>2：データ採取を停止します。</p>
<p><sup>*</sup>3：何も処理をしません。</p>
</div>
</div></blockquote>
</section>
<section id="id5">
<h3><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">6.11.2.2. </span>区間モードの応用例</a><a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">区間モードを利用してソースの変更を行わずにMPI_Init後からMPI_Finalize前までを測定する方法を示します。ソースコード中に区間指定ルーチンを挿入できない場合等にご利用ください。</div>
<div class="line">全体モードはMPIアプリケーション全体の実行情報を収集します。このためMPI_Initの内部処理で発生する通信も含めて集計しています。MPI_Initの内部処理も含むため、高並列になるほど目的以外の通信回数が統計情報に出てきます。ここに示す応用例では、区間モードを利用して、MPI_InitとMPI_Finalizeを測定対象外とします。</div>
</div>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>ここに示すPMPIを利用した手順でプログラムを実行する場合、プロファイラおよび実行時情報出力機能を利用することはできません。プロファイラおよび実行時情報出力機能を利用する場合は、ここで示すinit_finalize_hookのプログラムを使用しないようにしてください。</p>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">区間指定用ソースプログラムの準備</div>
<div class="line">MPI_Init/MPI_FinalizeをFortranから実行している場合は「<code class="file docutils literal notranslate"><span class="pre">init_finalize_hookf.f08</span></code>」を、C/C++から実行している場合は「<code class="file docutils literal notranslate"><span class="pre">init_finalize_hookc.c</span></code>」を用意します。</div>
<div class="line">使用している言語に合わせてコンパイルします。</div>
</div>
<p>[init_finalize_hookf.f08]</p>
</li>
</ol>
<blockquote>
<div><div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="k">SUBROUTINE </span><span class="n">MPI_INIT</span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="k">INCLUDE</span><span class="w"> </span><span class="s2">&quot;mpif.h&quot;</span>
<span class="kt">INTEGER </span><span class="n">ierr</span>

<span class="k">CALL </span><span class="n">PMPI_INIT</span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>

<span class="k">CALL </span><span class="n">FJMPI_Collection_start</span><span class="p">()</span>

<span class="k">RETURN</span>
<span class="k">END</span>
<span class="k">SUBROUTINE </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="k">INCLUDE</span><span class="w"> </span><span class="s2">&quot;mpif.h&quot;</span>
<span class="kt">INTEGER </span><span class="n">ierr</span>
<span class="kt">CHARACTER</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">STR</span>

<span class="n">STR</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="k">CALL </span><span class="n">FJMPI_Collection_stop</span><span class="p">()</span>
<span class="k">CALL </span><span class="n">FJMPI_Collection_print</span><span class="p">(</span><span class="n">STR</span><span class="p">)</span>

<span class="k">CALL </span><span class="n">PMPI_FINALIZE</span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>

<span class="k">RETURN</span>
<span class="k">END</span>
</pre></div>
</div>
<p>[init_finalize_hookc.c]</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mpi.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mpi-ext.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">MPI_Init</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">***</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>

<span class="w">    </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PMPI_Init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>

<span class="w">    </span><span class="n">FJMPI_Collection_start</span><span class="p">();</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="w"> </span><span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">MPI_Finalize</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>

<span class="w">    </span><span class="n">FJMPI_Collection_stop</span><span class="p">();</span>
<span class="w">    </span><span class="n">FJMPI_Collection_print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PMPI_Finalize</span><span class="p">();</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>[コンパイル実行]</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mpifrtpx<span class="w"> </span>-G<span class="w"> </span>-KPIC<span class="w"> </span>init_finalize_hookf.f08<span class="w"> </span>-o<span class="w"> </span>libhookf.so
<span class="gp">$ </span>mpifrtpx<span class="w"> </span>-c<span class="w"> </span>-KPIC<span class="w"> </span>init_finalize_hookf.f08
<span class="gp">$ </span>mpifccpx<span class="w"> </span>-G<span class="w"> </span>-KPIC<span class="w"> </span>init_finalize_hookc.c<span class="w"> </span>-o<span class="w"> </span>libhookc.so
<span class="gp">$ </span>mpifccpx<span class="w"> </span>-c<span class="w"> </span>-KPIC<span class="w"> </span>init_finalize_hookc.c
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><div class="line-block">
<div class="line">動的リンクによる実行</div>
<div class="line">実行モジュールの再リンクが困難な場合は、動的リンクによる実行を行います。本方法では後述の静的リンクの場合に比べてMPIレイテンシ性能が劣化します。</div>
</div>
</li>
</ol>
<blockquote>
<div><p>動的リンクによる実行は、実行時に<code class="docutils literal notranslate"><span class="pre">LD_PRELOAD</span></code>で<code class="file docutils literal notranslate"><span class="pre">libhookf.so</span></code>（<code class="file docutils literal notranslate"><span class="pre">libhookc.so</span></code>）を<code class="docutils literal notranslate"><span class="pre">LD_PRELOAD</span></code>に指定するだけです。以下の動的リンクによる実行例（ジョブスクリプト）に示すように<code class="file docutils literal notranslate"><span class="pre">libhookf.so</span></code>（C/C++の場合は<code class="file docutils literal notranslate"><span class="pre">libhookc.so</span></code>）に、<code class="docutils literal notranslate"><span class="pre">LD_PRELOAD</span></code>の指定を追加して実行します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -x</span>
<span class="c1">#</span>
<span class="c1">#PJM -L &quot;node=8&quot;</span>
<span class="c1">#PJM -L &quot;rscgrp=small&quot;</span>
<span class="c1">#PJM -L &quot;elapse=01:00:00&quot;</span>
<span class="c1">#PJM -g groupname</span>
<span class="c1">#PJM -x PJM_LLIO_GFSCACHE=/vol000N</span>
<span class="c1">#PJM -s</span>
<span class="c1">#</span>

mpiexec<span class="w"> </span>-x<span class="w"> </span><span class="nv">LD_PRELOAD</span><span class="o">=</span>./libhookf.so<span class="w"> </span>-mca<span class="w"> </span>mpi_print_stats<span class="w"> </span><span class="m">3</span><span class="w"> </span>./a.out
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="3">
<li><div class="line-block">
<div class="line">静的リンクによる実行</div>
<div class="line">実行モジュールの再リンクを行う方法です。</div>
<div class="line"><code class="file docutils literal notranslate"><span class="pre">init_finalize_hookf.o</span></code>（または、<code class="file docutils literal notranslate"><span class="pre">init_finalize_hookc.o</span></code>）をリンクして実行モジュールを作り直します。できあがった実行モジュールでMPI統計情報を収集します。</div>
<div class="line">再リンク方法の例を次に示します。<code class="file docutils literal notranslate"><span class="pre">init_finalize_hookf.o</span></code>（または、<code class="file docutils literal notranslate"><span class="pre">init_finalize_hookc.o</span></code>）をリンク時に追加してリンクしてください。</div>
<div class="line">再リンクしてできあがった実行モジュールを実行します。</div>
</div>
</li>
</ol>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mpifrtpx<span class="w"> </span>-o<span class="w"> </span>a.out<span class="w"> </span>init_finalize_hookf.o<span class="w"> </span><span class="c1">#プログラムのオブジェクト</span>
<span class="gp">$ </span>mpifccpx<span class="w"> </span>-o<span class="w"> </span>a.out<span class="w"> </span>init_finalize_hookc.o<span class="w"> </span><span class="c1">#プログラムのオブジェクト</span>
</pre></div>
</div>
<p>【静的リンクによる実行例（ジョブスクリプト）】</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -x</span>
<span class="c1">#</span>
<span class="c1">#PJM -L &quot;node=8&quot;</span>
<span class="c1">#PJM -L &quot;rscgrp=small&quot;</span>
<span class="c1">#PJM -L &quot;elapse=01:00:00&quot;</span>
<span class="c1">#PJM -g groupname</span>
<span class="c1">#PJM -x PJM_LLIO_GFSCACHE=/vol000N</span>
<span class="c1">#PJM -s</span>
<span class="c1">#</span>

mpiexec<span class="w"> </span>-mca<span class="w"> </span>mpi_print_stats<span class="w"> </span><span class="m">3</span><span class="w"> </span>./a.out
</pre></div>
</div>
</div></blockquote>
</section>
<section id="id6">
<h3><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">6.11.2.3. </span>区間モードの出力内容</a><a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p>区間モードでは、FJMPI_COLLECTION_PRINTが指定されていない場合、統計情報は出力されません。FJMPI_COLLECTION_PRINTは、指定される度に統計情報が出力されます。</p>
<p>各出力項目については、マニュアル「MPI使用手引書」の「区間指定出力モードMPI統計情報の出力内容」を参照してください。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>Hasty_Rendezvousの統計情報は「Hasty Rendezvous通信を使用する（<code class="docutils literal notranslate"><span class="pre">--mca</span> <span class="pre">pml_ob1_use_hasty_rendezvous</span> <span class="pre">1</span></code>）」を指定した場合のみ表示されます。</p>
</div>
</section>
<section id="id7">
<h3><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">6.11.2.4. </span>区間モード使用時の留意事項</a><a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>FJMPI_COLLECTION_PRINTの指定がない場合は統計情報は出力されません。</p></li>
<li><p>FJMPI_COLLECTION_PRINT使用時、MCAパラメーター<code class="docutils literal notranslate"><span class="pre">mpi_print_stats</span></code>に 3を指定した場合、同じ MPI_COMM_WORLD に属する全プロセスが同時に呼び出す必要があります。正しく呼び出しを行わないと、デッドロックの原因となります。</p></li>
<li><p>測定区間の指定（FJMPI_COLLECTION_START/ FJMPI_COLLECTION_STOP）を入れ子に指定しないでください。入れ子になっていた場合の結果は保証されません。</p></li>
<li><p>FJMPI_COLLECTION_CLEARを指定するまで、測定区間の統計情報は累積されます。複数の測定区間を設定する場合は、どの区間が累積されるかに留意ください。</p></li>
<li><p>FJMPI_COLLECTION_PRINTの引数（文字列）は出力時にSection見出しに出力されます。見出しに出力される以外の効果はありません。文字列は印字可能な文字で30文字以内としてください。</p></li>
</ul>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">6.11. MPI統計情報</a><ul>
<li><a class="reference internal" href="#id1">6.11.1. 全体モード</a></li>
<li><a class="reference internal" href="#id2">6.11.2. 区間モード</a><ul>
<li><a class="reference internal" href="#id4">6.11.2.1. 区間指定ルーチン</a></li>
<li><a class="reference internal" href="#id5">6.11.2.2. 区間モードの応用例</a></li>
<li><a class="reference internal" href="#id6">6.11.2.3. 区間モードの出力内容</a></li>
<li><a class="reference internal" href="#id7">6.11.2.4. 区間モード使用時の留意事項</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="RankInquiryFunctions.html"
                          title="前の章へ"><span class="section-number">6.10. </span>ランク問い合わせ関数</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="CollectiveCommunicationAlgorithm.html"
                          title="次の章へ"><span class="section-number">6.12. </span>MPIの集団通信アルゴリズム（knomial, rabenseifner）</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="CollectiveCommunicationAlgorithm.html" title="6.12. MPIの集団通信アルゴリズム（knomial, rabenseifner）"
             >次へ</a></li>
        <li class="right" >
          <a href="RankInquiryFunctions.html" title="6.10. ランク問い合わせ関数"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">利用手引書 利用およびジョブ実行編  ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" ><span class="section-number">6. </span>MPIジョブ実行</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6.11. </span>MPI統計情報</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2025, 理化学研究所計算科学研究センター.
    &nbsp;&nbsp;<a href="https://www.fugaku.r-ccs.riken.jp/">Fugaku website Top</a>
    </div>
  </body>
</html>