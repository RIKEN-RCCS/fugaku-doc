

<!doctype html>

<html lang="ja" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>8.5. 共有テンポラリ領域 &#8212; 利用手引書 利用およびジョブ実行編  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css?v=532c1bf3" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=89e52957" />
    
    <script src="../_static/documentation_options.js?v=c033477b"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=4dbe4bdc"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="8.6. 留意事項" href="LLIOconsiderpoints.html" />
    <link rel="prev" title="8.4. ノード内テンポラリ領域" href="TemporaryAreaInNode.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="LLIOconsiderpoints.html" title="8.6. 留意事項"
             accesskey="N">次へ</a></li>
        <li class="right" >
          <a href="TemporaryAreaInNode.html" title="8.4. ノード内テンポラリ領域"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">利用手引書 利用およびジョブ実行編  ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span class="section-number">8. </span>階層化ストレージ</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">8.5. </span>共有テンポラリ領域</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="sharedtemporaryarea">
<span id="id1"></span><h1><span class="section-number">8.5. </span>共有テンポラリ領域<a class="headerlink" href="#sharedtemporaryarea" title="Link to this heading">¶</a></h1>
<p>同一ジョブ内で第1階層ストレージを共有して使用できます。</p>
<p>共有テンポラリ領域は同一ジョブ内であれば複数の計算ノード間で共有できます。共有テンポラリ領域は、ジョブ開始時に使用可能になり、ジョブ終了時に使用できなくなります。そのため利用者はジョブ実行結果ファイルなど退避しておきたいファイルを、第2階層ストレージのキャッシュ領域(または2ndfs領域)に配置する必要があります。</p>
<ol class="arabic simple">
<li><p>共有テンポラリ領域は、ジョブ内の複数の計算ノードから共有することができます。</p></li>
<li><p>共有テンポラリ領域は、ジョブ開始時に使用可能になり、ジョブ終了時に消去されます。ジョブ実行結果ファイルなど退避は第2階層ストレージのキャッシュ領域(または2ndfs領域)に配置する必要があります。</p></li>
<li><p>共有テンポラリ領域を使用するには、ジョブ投入時に<strong class="program">pjsub</strong>コマンドのオプションで、<code class="docutils literal notranslate"><span class="pre">--llio</span> <span class="pre">sharedtmp-size</span></code>で任意の領域サイズを指定する必要があります。</p></li>
<li><p>共有テンポラリ領域のパス名は、ジョブ内で環境変数PJM_SHAREDTMPにより参照できます。</p></li>
</ol>
<figure class="align-default">
<img alt="../_images/SharedTemporaryArea_01.png" src="../_images/SharedTemporaryArea_01.png" />
</figure>
<ol class="arabic" start="5">
<li><p>共有テンポラリ領域の仕様を説明します。</p>
<table class="docutils align-default" id="id5">
<caption><span class="caption-text">共有テンポラリ領域の仕様</span><a class="headerlink" href="#id5" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>特性</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>参照範囲</p></td>
<td><p>ジョブに割り当てられた計算ノード間で参照できます。同じジョブの中であれば複数の計算ノードから参照できます。</p></td>
</tr>
<tr class="row-odd"><td><p>生存期間</p></td>
<td><p>ジョブ起動前に初期化され、ジョブ終了時に削除されます。</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
<section id="stripesettingforsharedtemporaryarea">
<span id="id2"></span><h2><span class="section-number">8.5.1. </span>共有テンポラリ領域に対するストライプ設定<a class="headerlink" href="#stripesettingforsharedtemporaryarea" title="Link to this heading">¶</a></h2>
<p>共有テンポラリ領域を複数の第1階層デバイスに分散して格納することにより、ファイルアクセスの帯域幅が向上します。
ユーザはジョブ投入時にアプリケーションのI/O特性（シーケンシャルアクセスが多いなど）に合わせてストライプサイズやストライプカウントを指定します。
これにより、共有テンポラリ領域への効率なアクセスが可能になります。</p>
<figure class="align-default">
<img alt="../_images/StripeSettingForSharedTemporaryArea_01.png" src="../_images/StripeSettingForSharedTemporaryArea_01.png" />
</figure>
<p>ストライプカウントを3に設定する例を示します。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 33.3%" />
<col style="width: 33.3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>領域名</p></th>
<th class="head"><p>Lfsコマンド</p></th>
<th class="head"><p>pjsub --llioオプション</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>共有テンポラリ領域</p></td>
<td><p>－</p></td>
<td><p>✓</p></td>
</tr>
</tbody>
</table>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pjsub<span class="w">  </span>--llio<span class="w">  </span>stripe-count<span class="o">=</span><span class="m">3</span><span class="w">  </span>jobscript.sh
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<ul class="simple">
<li><p>設定できるストライプカウントの上限は現在24です。</p></li>
<li><p>LLIOのストライプカウントのデフォルトは24です。</p></li>
</ul>
</div>
</section>
<section id="id3">
<h2><span class="section-number">8.5.2. </span>共有テンポラリ領域の容量<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">共有テンポラリ領域を使う場合、そのサイズはジョブ投入時に指定できます。</div>
<div class="line"><strong class="program">pjsub</strong>コマンドの<code class="docutils literal notranslate"><span class="pre">--llio</span></code>オプションのパラメーター<code class="docutils literal notranslate"><span class="pre">sharedtmp-size</span></code>で&quot;共有テンポラリ領域のサイズ÷割当てノード数&quot;を指定します。サイズを指定しない場合は、システムで設定されているデフォルト値(0MiB)になります。</div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 33.3%" />
<col style="width: 33.3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>領域名</p></th>
<th class="head"><p>オプション</p></th>
<th class="head"><p>指定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>共有テンポラリ領域</p></td>
<td><p>--llio sharedtmp-size</p></td>
<td><p>共有テンポラリ領域サイズ÷ジョブ割当ノード数</p></td>
</tr>
</tbody>
</table>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<ul>
<li><div class="line-block">
<div class="line">パラメーターsharedtmp-sizeで指定する値は、ジョブが利用できる共有テンポラリ領域全体のサイズではありません。共有テンポラリ領域全体のサイズは、パラメーターsharedtmp-sizeで指定する値にジョブに割り当てるノード数を乗じた値になります。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">ジョブ投入時に指定した共有テンポラリ領域のサイズまで容量を消費していないにも関わらず、空き容量不足でエラーになることがあります。</div>
<div class="line">これは、ジョブが複数のストレージI/Oノードを利用し、1つのストレージI/Oノードの利用可能容量を使い切ったことが原因と考えられます。</div>
<div class="line">上記現象が発生した場合、共有テンポラリ領域の容量を増やしてジョブを実行してください。</div>
</div>
</li>
</ul>
</div>
<p><a class="reference internal" href="TheSecondLayerStrage.html#volumeofstrage"><span class="std std-ref">第2階層ストレージのキャッシュの容量</span></a>に128MiB以上を割り当てる必要があります。サイズの指定は次を満たすようにしてください。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">128</span><span class="n">MiB</span> <span class="o">&lt;=</span> <span class="mi">87</span><span class="n">GiB</span> <span class="o">-</span> <span class="p">(</span><span class="n">localtmp</span><span class="o">-</span><span class="n">size</span> <span class="o">+</span> <span class="n">sharedtmp</span><span class="o">-</span><span class="n">size</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id4">
<h2><span class="section-number">8.5.3. </span>利用方法<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p>ジョブ投入時にオプションを指定することで、共有テンポラリ領域を利用できます。</p>
<ol class="arabic">
<li><p>ジョブを投入します。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pjsub<span class="w"> </span>--llio<span class="w"> </span>sharedtmp-size<span class="o">=</span>size<span class="w">   </span>jobscript.sh
</pre></div>
</div>
</li>
<li><p>共有テンポラリ領域のパス名（ディレクトリ名）は、環境変域PJM_SHAREDTMPに設定されます。</p>
<p>ジョブ内で設定されている環境変数PJM_SHAREDTMPで確認できます。以下は、共有テンポラリ領域を一時的なデータの格納先として利用する簡単なジョブの例です。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>prog1 -o ${PJM_SHAREDTMP}/out.data
</pre></div>
</div>
</li>
<li><p>ファイルout.dataをプログラムprog2が読み込んで、ディレクトリ${PJM_SHAREDTMP}に最終的な計算結果result.dataを出力します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>prog2 -i ${PJM_SHAREDTMP}/out.data -o ${PJM_SHAREDTMP}/result.data
</pre></div>
</div>
</li>
<li><p>ジョブの終了前にファイルresult.dataをジョブ実行時のディレクトリ${PJM_JOBDIR}(グローバルファイルシステム上)に、ジョブID${PJM_JOBID}をつけた名前に変えて退避します。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cp<span class="w"> </span><span class="si">${</span><span class="nv">PJM_SHAREDTMP</span><span class="si">}</span>/result.data<span class="w"> </span><span class="si">${</span><span class="nv">PJM_JOBDIR</span><span class="si">}</span>/result_<span class="si">${</span><span class="nv">PJM_JOBID</span><span class="si">}</span>.data
</pre></div>
</div>
</li>
</ol>
</section>
<section id="pjsub-llio">
<h2><span class="section-number">8.5.4. </span>ジョブ投入時（pjsub --llio）のオプション<a class="headerlink" href="#pjsub-llio" title="Link to this heading">¶</a></h2>
<p>共有テンポラリ領域に関連するオプションを説明します。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37.5%" />
<col style="width: 62.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>pjsubオプション</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sharedtmp-size=size</p></td>
<td><div class="line-block">
<div class="line">共有テンポラリ領域のサイズを指定します。（デフォルト0Mi）</div>
<div class="line">共有テンポラリ領域のパス名は、ジョブ内で環境変数PJM_SHAREDTMPに設定されます。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>stripe-count=count</p></td>
<td><p>共有テンポラリ領域にファイルを分散配置する際のファイル当たりのストライプ数を指定します。（デフォルト24）</p></td>
</tr>
<tr class="row-even"><td><p>stripe-size=size</p></td>
<td><p>共有テンポラリ領域にファイルを分散配置する際のストライプサイズを指定します。（デフォルト2048Ki）</p></td>
</tr>
<tr class="row-odd"><td><p>async-close={on|off}</p></td>
<td><div class="line-block">
<div class="line">共有テンポラリ領域のクローズを非同期クローズにするか否かの動作を指定します。</div>
<div class="line">計算ノード内のキャッシュから第1階層ストレージに対する同期/非同期クローズ指定</div>
<div class="line"><br /></div>
<div class="line">on: 非同期クローズ</div>
<div class="line">off: 同期クローズ（デフォルト）</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>perf[,perf-path=path]</p></td>
<td><div class="line-block">
<div class="line">LLIO性能情報をファイルに出力します。</div>
<div class="line">出力先はジョブ投入時のカレントディレクトリ配下で、ファイル名はジョブACL機能で定義されている名前です。なお、パラメーター perf-pathで出力先のファイルを指定できます。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<ul>
<li><div class="line-block">
<div class="line">（デフォルト値）は、運用状況に応じて各リソースグループ毎に変更される可能性があります。現在のデフォルト値は、pjacl --rg &lt;リソースグループ名&gt; コマンドで確認することができます。</div>
</div>
</li>
</ul>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">8.5. 共有テンポラリ領域</a><ul>
<li><a class="reference internal" href="#stripesettingforsharedtemporaryarea">8.5.1. 共有テンポラリ領域に対するストライプ設定</a></li>
<li><a class="reference internal" href="#id3">8.5.2. 共有テンポラリ領域の容量</a></li>
<li><a class="reference internal" href="#id4">8.5.3. 利用方法</a></li>
<li><a class="reference internal" href="#pjsub-llio">8.5.4. ジョブ投入時（pjsub --llio）のオプション</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="TemporaryAreaInNode.html"
                          title="前の章へ"><span class="section-number">8.4. </span>ノード内テンポラリ領域</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="LLIOconsiderpoints.html"
                          title="次の章へ"><span class="section-number">8.6. </span>留意事項</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="LLIOconsiderpoints.html" title="8.6. 留意事項"
             >次へ</a></li>
        <li class="right" >
          <a href="TemporaryAreaInNode.html" title="8.4. ノード内テンポラリ領域"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">利用手引書 利用およびジョブ実行編  ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" ><span class="section-number">8. </span>階層化ストレージ</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">8.5. </span>共有テンポラリ領域</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2025, 理化学研究所計算科学研究センター.
    &nbsp;&nbsp;<a href="https://www.fugaku.r-ccs.riken.jp/">Fugaku website Top</a>
    </div>
  </body>
</html>