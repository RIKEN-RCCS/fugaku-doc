

<!doctype html>

<html lang="ja" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>8.2. FEFS/LLIOへのファイル操作について &#8212; 利用手引書 利用およびジョブ実行編  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css?v=532c1bf3" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=89e52957" />
    
    <script src="../_static/documentation_options.js?v=c033477b"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=4dbe4bdc"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="8.3. 第2階層ストレージのキャッシュ領域" href="TheSecondLayerStrage.html" />
    <link rel="prev" title="8.1. 概要" href="OverView.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="TheSecondLayerStrage.html" title="8.3. 第2階層ストレージのキャッシュ領域"
             accesskey="N">次へ</a></li>
        <li class="right" >
          <a href="OverView.html" title="8.1. 概要"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">利用手引書 利用およびジョブ実行編  ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span class="section-number">8. </span>階層化ストレージ</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">8.2. </span>FEFS/LLIOへのファイル操作について</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="fefs-llio">
<span id="writeforfilesystem"></span><h1><span class="section-number">8.2. </span>FEFS/LLIOへのファイル操作について<a class="headerlink" href="#fefs-llio" title="Link to this heading">¶</a></h1>
<p>・書込み操作</p>
<blockquote>
<div><p>FEFS/LLIOへのファイル書込み方法について、LLIOはFEFSのアクセス方法とは異なる部分があります。
そのため、1ファイルに対して書込むプロセス数や、IO方法に分けて説明します。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>領域名</p></th>
<th class="head"><p>ファイル書込みプロセス数</p></th>
<th class="head"><p>1プロセス</p></th>
<th class="head" colspan="2"><p>複数プロセス</p></th>
</tr>
<tr class="row-even"><th class="head"><p>IO方法</p></th>
<th class="head"><p>MPI-IO使用しない</p></th>
<th class="head"><p>MPI-IO使用</p></th>
<th class="head"><p>MPI-IO使用しない</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td colspan="2"><p>ノード内テンポラリ領域</p></td>
<td><p><a class="reference internal" href="#writeoneproc"><span class="std std-ref">１ファイルに対して１プロセスから書込む場合</span></a></p></td>
<td><p><a class="reference internal" href="#writemultiprocmpi"><span class="std std-ref">MPI-IOを使用したファイル書込み方法</span></a> (*)</p></td>
<td><p><a class="reference internal" href="#writemultiprocsys"><span class="std std-ref">MPI-IOを使用しないファイル書込み方法</span></a> (*)</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>共有テンポラリ領域</p></td>
<td><p><a class="reference internal" href="#writeoneproc"><span class="std std-ref">１ファイルに対して１プロセスから書込む場合</span></a></p></td>
<td><p><a class="reference internal" href="#writemultiprocmpi"><span class="std std-ref">MPI-IOを使用したファイル書込み方法</span></a></p></td>
<td><p><a class="reference internal" href="#writemultiprocsys"><span class="std std-ref">MPI-IOを使用しないファイル書込み方法</span></a></p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>第2階層ストレージのキャッシュ領域</p></td>
<td><p><a class="reference internal" href="#writeoneproc"><span class="std std-ref">１ファイルに対して１プロセスから書込む場合</span></a></p></td>
<td><p><a class="reference internal" href="#writemultiprocmpi"><span class="std std-ref">MPI-IOを使用したファイル書込み方法</span></a></p></td>
<td><p><a class="reference internal" href="#writemultiprocsys"><span class="std std-ref">MPI-IOを使用しないファイル書込み方法</span></a></p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>第2階層ストレージ</p></td>
<td><p><a class="reference internal" href="#writeoneproc"><span class="std std-ref">１ファイルに対して１プロセスから書込む場合</span></a></p></td>
<td><p><a class="reference internal" href="#writemultiprocmpi"><span class="std std-ref">MPI-IOを使用したファイル書込み方法</span></a></p></td>
<td><p><a class="reference internal" href="#writemultiprocsys"><span class="std std-ref">MPI-IOを使用しないファイル書込み方法</span></a></p></td>
</tr>
</tbody>
</table>
<p>(* : ノード内に閉じた場合のみ使用可能)</p>
</div></blockquote>
<p>・ファイル名変更操作</p>
<blockquote>
<div><p>ファイル名変更操作については、<a class="reference internal" href="#renameexec"><span class="std std-ref">ファイル名変更</span></a> で説明しています。</p>
</div></blockquote>
<p>・ファイル削除操作</p>
<blockquote>
<div><p>ファイル削除操作については、<a class="reference internal" href="#unlinkexec"><span class="std std-ref">ファイル削除</span></a> で説明しています。</p>
</div></blockquote>
<section id="writeoneproc">
<span id="id1"></span><h2><span class="section-number">8.2.1. </span>１ファイルに対して１プロセスから書込む場合<a class="headerlink" href="#writeoneproc" title="Link to this heading">¶</a></h2>
<p>1ファイルに対して1プロセスから書込みを行う場合は、FEFS/LLIOともに、write処理を実施します。</p>
<figure class="align-default">
<img alt="../_images/WriteFileSingleProcess_01.png" src="../_images/WriteFileSingleProcess_01.png" />
</figure>
<p>[１ファイルに対して１プロセスから 1 MB のデータを書込むコード例]</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">;</span>
<span class="linenos">2</span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_CREAT</span><span class="p">,</span><span class="w"> </span><span class="mo">0644</span><span class="p">);</span>
<span class="linenos">3</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">);</span>
<span class="linenos">4</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>コード例では省略していますが、open処理やwrite処理などのエラー対処は必ず行うようにしてください。</p>
</div>
</div></blockquote>
</section>
<section id="id2">
<h2><span class="section-number">8.2.2. </span>１ファイルに対して複数プロセスから書込む場合<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>1ファイルに対して、複数プロセスから書込みを行う場合について、MPI-IOを用いた場合とwriteシステムコールを用いた場合で説明します。</p>
<figure class="align-default">
<img alt="../_images/WriteFileMultiProcess_01.png" src="../_images/WriteFileMultiProcess_01.png" />
</figure>
<section id="mpi-io">
<span id="writemultiprocmpi"></span><h3><span class="section-number">8.2.2.1. </span>MPI-IOを使用したファイル書込み方法<a class="headerlink" href="#mpi-io" title="Link to this heading">¶</a></h3>
<p>FEFS/LLIOともに、１ファイルに対して複数プロセスから書込む場合、MPI-IOを利活用できます。</p>
<p>[新規で作成した１ファイルに対して複数プロセスから 1 MB ずつデータを書込むコード例]</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">MPI_File</span><span class="w"> </span><span class="n">fh</span><span class="p">;</span>
<span class="linenos">2</span><span class="n">MPI_File_open</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;output.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MPI_MODE_CREATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MPI_MODE_WRONLY</span><span class="p">,</span><span class="w"> </span><span class="n">MPI_INFO_NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fh</span><span class="p">);</span>
<span class="linenos">3</span><span class="n">MPI_Offset</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RANK</span><span class="o">*</span><span class="mi">1000000</span><span class="p">;</span>
<span class="linenos">4</span><span class="n">MPI_File_write_at</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="n">MPI_CHAR</span><span class="p">,</span><span class="w"> </span><span class="n">MPI_STATUS_IGNORE</span><span class="p">);</span>
<span class="linenos">5</span><span class="n">MPI_File_close</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fh</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>コード例では省略していますが、MPI_File_open処理やMPI_File_write_at処理などのエラー対処は必ず行うようにしてください。</p>
</div>
</div></blockquote>
<p>ファイルを追記モード(MPI_MODE_APPEND)でopenした場合の例も記載します。</p>
<p>[追記モードでオープンした１ファイルに対して複数プロセスから 1 MB ずつデータを書込むコード例]</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">MPI_File</span><span class="w"> </span><span class="n">fh</span><span class="p">;</span>
<span class="linenos">2</span><span class="n">MPI_File_open</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;output.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MPI_MODE_APPEND</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MPI_MODE_WRONLY</span><span class="p">,</span><span class="w"> </span><span class="n">MPI_INFO_NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fh</span><span class="p">);</span>
<span class="linenos">3</span><span class="n">MPI_File_write</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="n">MPI_CHAR</span><span class="p">,</span><span class="w"> </span><span class="n">MPI_STATUS_IGNORE</span><span class="p">);</span>
<span class="linenos">4</span><span class="n">MPI_File_close</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fh</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>コード例では省略していますが、MPI_File_open処理やMPI_File_write処理などのエラー対処は必ず行うようにしてください。</p>
</div>
</div></blockquote>
</section>
<section id="writemultiprocsys">
<span id="id3"></span><h3><span class="section-number">8.2.2.2. </span>MPI-IOを使用しないファイル書込み方法<a class="headerlink" href="#writemultiprocsys" title="Link to this heading">¶</a></h3>
<p>MPI-IOを使用しないファイル書込み方法については、FEFS/LLIOで処理の実装方法が異なります。</p>
<p id="writemultiprocsysfefs">・FEFS</p>
<blockquote>
<div><p>FEFSでは、ファイルシステムの一貫性を保つため、lockを取得せずに、書き込み処理(write処理)を実行します。</p>
<p>[新規で作成した１ファイルに対して複数プロセスから 1 MB ずつデータを書込むコード例]</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">;</span>
<span class="linenos">2</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_CREAT</span><span class="p">,</span><span class="w"> </span><span class="mo">0644</span><span class="p">);</span>
<span class="linenos">3</span><span class="w"> </span><span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">RANK</span><span class="o">*</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="n">SEEK_SET</span><span class="p">);</span>
<span class="linenos">4</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">);</span>
<span class="linenos">5</span><span class="w"> </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>コード例では省略していますが、open処理やwrite処理などのエラー対処は必ず行うようにしてください。</p>
</div>
<p>ファイルを追記モード(O_APPEND)でopenした場合の例も記載します。</p>
<p>[追記モードの１ファイルに対して複数プロセスから 1 MB ずつデータを書込むコード例]</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">;</span>
<span class="linenos">2</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_APPEND</span><span class="p">,</span><span class="w"> </span><span class="mo">0644</span><span class="p">);</span>
<span class="linenos">3</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">);</span>
<span class="linenos">4</span><span class="w"> </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>コード例では省略していますが、open処理やwrite処理などのエラー対処は必ず行うようにしてください。</p>
</div>
</div></blockquote>
<p id="writemultiprocsysllio">・LLIO</p>
<blockquote>
<div><p>LLIOの場合は、ファイルシステムにて一貫性の制御を行いません。
そのため、lockを取得してwrite処理を行う、または、Direct I/Oを用いてwrite処理を行います。</p>
<p>LLIOで使用可能はlockは、flock(2)、fcntl(2)です。</p>
<p>fcntl(2)でlockを取得してwrite処理を行うコード例を以下に記載します。</p>
<p>なお、第2階層ストレージキャッシュ領域で、第2階層ストレージへの書出しタイミングを制御したい場合は、<a class="reference internal" href="TheSecondLayerStrage.html#fefswritetiming"><span class="std std-ref">第2階層ストレージへの書出しタイミング</span></a>を参照してください。</p>
<p>[１ファイルに対して複数プロセスから 1 MB ずつデータを書込むコード例]</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">;</span>
<span class="linenos">2</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_CREAT</span><span class="p">,</span><span class="w"> </span><span class="mo">0644</span><span class="p">);</span>
<span class="linenos">3</span><span class="w"> </span><span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">RANK</span><span class="o">*</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="n">SEEK_SET</span><span class="p">);</span>
<span class="linenos">4</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">flock</span><span class="w"> </span><span class="n">lk0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{.</span><span class="n">l_type</span><span class="o">=</span><span class="n">F_WRLCK</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">l_whence</span><span class="o">=</span><span class="n">SEEK_SET</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">l_start</span><span class="o">=</span><span class="n">RANK</span><span class="o">*</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">l_len</span><span class="o">=</span><span class="mi">1000000</span><span class="p">};</span>
<span class="linenos">5</span><span class="w"> </span><span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">F_SETLK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lk0</span><span class="p">);</span>
<span class="linenos">6</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">);</span>
<span class="linenos">7</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">flock</span><span class="w"> </span><span class="n">lk1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{.</span><span class="n">l_type</span><span class="o">=</span><span class="n">F_UNLCK</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">l_whence</span><span class="o">=</span><span class="n">SEEK_SET</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">l_start</span><span class="o">=</span><span class="n">RANK</span><span class="o">*</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">l_len</span><span class="o">=</span><span class="mi">1000000</span><span class="p">};</span>
<span class="linenos">8</span><span class="w"> </span><span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">F_SETLK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lk1</span><span class="p">);</span>
<span class="linenos">9</span><span class="w"> </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>コード例では省略していますが、open処理やwrite処理などのエラー対処は必ず行うようにしてください。</p>
</div>
<p>ファイルを追記モード(O_APPEND)でopenした場合の例も記載します。</p>
<p>[追記モードの１ファイルに対して複数プロセスから 1 MB ずつデータを書込むコード例]</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">;</span>
<span class="linenos">2</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_APPEND</span><span class="p">,</span><span class="w"> </span><span class="mo">0644</span><span class="p">);</span>
<span class="linenos">3</span><span class="w"> </span><span class="n">flock</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">LOCK_EX</span><span class="p">)</span>
<span class="linenos">4</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">);</span>
<span class="linenos">5</span><span class="w"> </span><span class="n">flock</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">LOCK_UN</span><span class="p">);</span>
<span class="linenos">6</span><span class="w"> </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>コード例では省略していますが、open処理やwrite処理などのエラー対処は必ず行うようにしてください。</p>
</div>
<p>Direct I/Oでのwrite処理のコード例を以下に記載します。
write時のアライメントや書込みサイズについては、計算ノードのページキャッシュのサイズ 64 KiB を考慮する必要があります。</p>
<p>[１ファイルに対して複数プロセスから 1 MB ずつデータを書込むコード例]</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="mi">1000000</span><span class="o">*</span><span class="mi">100</span>
<span class="linenos">2</span><span class="w"> </span><span class="n">posix_memalign</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="linenos">3</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">;</span>
<span class="linenos">4</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_DIRECT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_SYNC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_CREAT</span><span class="p">,</span><span class="w"> </span><span class="mo">0644</span><span class="p">);</span>
<span class="linenos">5</span><span class="w"> </span><span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">RANK</span><span class="o">*</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="n">SEEK_SET</span><span class="p">);</span>
<span class="linenos">6</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">);</span>
<span class="linenos">7</span><span class="w"> </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>コード例では省略していますが、open処理やwrite処理などのエラー対処は必ず行うようにしてください。</p>
</div>
</div></blockquote>
</section>
</section>
<section id="renameexec">
<span id="id4"></span><h2><span class="section-number">8.2.3. </span>ファイル名変更<a class="headerlink" href="#renameexec" title="Link to this heading">¶</a></h2>
<p>ファイル名を変更する場合は、FEFS/LLIOいずれの場合も、rename処理を実施します。</p>
<p>ただし、第2階層ストレージのキャッシュ領域または共有テンポラリ領域において、計算ノードAでファイルAを別名に変更した後に再作成した場合、計算ノードBでは、ファイルAのopen(2)が失敗することや、計算ノードAでファイルAを別名に変更したファイルがopen(2)されることがあります。</p>
<p>回避するには、以下の対処が必要です</p>
<ul class="simple">
<li><p>計算ノードBでファイルAをopen(2)する前に、ファイルAが存在している親ディレクトリに対してlsコマンドを実行する。</p></li>
<li><p>計算ノードBでファイルAをopen(2)する前に、計算ノードAのファイルAの再作成後、60秒経過してからopen(2)を行う。</p></li>
</ul>
</section>
<section id="unlinkexec">
<span id="id5"></span><h2><span class="section-number">8.2.4. </span>ファイル削除<a class="headerlink" href="#unlinkexec" title="Link to this heading">¶</a></h2>
<p>ファイルを削除する場合は、FEFS/LLIOいずれの場合も、unlink処理を実施します。</p>
<p>ただし、第2階層ストレージのキャッシュ領域または共有テンポラリ領域において、計算ノードAでファイルAを削除した後に再作成した場合、計算ノードBでは、ファイルAのopen(2)が失敗することや、計算ノードAで削除したファイルがopen(2)されることがあります。</p>
<p>回避するには、以下の対処が必要です</p>
<ul class="simple">
<li><p>計算ノードBでファイルAをopen(2)する前に、ファイルAが存在している親ディレクトリに対してlsコマンドを実行する。</p></li>
<li><p>計算ノードBでファイルAをopen(2)する前に、計算ノードAのファイルAの再作成後、60秒経過してからopen(2)を行う。</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">8.2. FEFS/LLIOへのファイル操作について</a><ul>
<li><a class="reference internal" href="#writeoneproc">8.2.1. １ファイルに対して１プロセスから書込む場合</a></li>
<li><a class="reference internal" href="#id2">8.2.2. １ファイルに対して複数プロセスから書込む場合</a><ul>
<li><a class="reference internal" href="#mpi-io">8.2.2.1. MPI-IOを使用したファイル書込み方法</a></li>
<li><a class="reference internal" href="#writemultiprocsys">8.2.2.2. MPI-IOを使用しないファイル書込み方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#renameexec">8.2.3. ファイル名変更</a></li>
<li><a class="reference internal" href="#unlinkexec">8.2.4. ファイル削除</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="OverView.html"
                          title="前の章へ"><span class="section-number">8.1. </span>概要</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="TheSecondLayerStrage.html"
                          title="次の章へ"><span class="section-number">8.3. </span>第2階層ストレージのキャッシュ領域</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="TheSecondLayerStrage.html" title="8.3. 第2階層ストレージのキャッシュ領域"
             >次へ</a></li>
        <li class="right" >
          <a href="OverView.html" title="8.1. 概要"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">利用手引書 利用およびジョブ実行編  ドキュメント</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" ><span class="section-number">8. </span>階層化ストレージ</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">8.2. </span>FEFS/LLIOへのファイル操作について</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2025, 理化学研究所計算科学研究センター.
    &nbsp;&nbsp;<a href="https://www.fugaku.r-ccs.riken.jp/">Fugaku website Top</a>
    </div>
  </body>
</html>