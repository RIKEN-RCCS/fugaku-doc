Integrated development environment
==================================

Here explains about the function of integrated development environment and the use of it.


Overview
--------

The integrated development environment is a collective term for the "Eclipse IDE for Scientific Computing" package provided by the Eclipse Foundation and extensions for the "Technical Computing Suite".

- | "Eclipse IDE for Scientific Computing" package is called as Eclipse in below.
  | For more details, please refer to EclipseFoundation's official website (https://www.eclipse.org).

- Supporting extended function to "Technical Computing Suite" is called as Fujitsu extended function in below.

- Please refer to the Manual "IDE User's Guide" for building and job submission using the Fujitsu extension function.

.. attention::

  Eclipse, explained in this section, is using "Eclipse IDE 2020-06 R Packages". Procedures and screens may differ depending on the version of Eclipse, so please read appropriately.


Glossary
~~~~~~~~

The Eclipse glossary used in this section is as following.

For more details, please refer to Eclipse's Help and Eclipse Foundation official website.


.. list-table::
   :header-rows: 1
   :widths: 3 7
   
   * - Glossary
     - Description
   
   * - Work bench (Workbench)
     - Indicates the whole part of Eclipse main screen.
   
   * - View (View)
     - Indicates the sub windows shown on work bench. At the view, there are unique tool bar and the view having menu.
   
   * - Perspective (Perspective)
     - Defines a set of views to be displayed in the workbench and a layout.
   
   * - Work space (Workspace)
     - The workspace is a place to save development assets and user's work status, and save the status of work performed by the user and workbench setting information. You can create multiple workspaces, but you can only open one workspace at a time in the workbench.
   
   * - Project (Project)
     - Development assets are managed in the workspace in units called projects. You can create multiple projects in a workspace.
   
   * - Tool chanin (Toolchain)
     - Creates binary from source code and points the gathering of tools conposed of editor, compiler, assembler and Linker.
   
   * - Synchronized project (Synchronized project)
     - A synchronized project consists of files that are mirrored on the local system and one or more remote systems. Editing is done on the local system, and each file is synchronized with the active remote system when it is modified, created, or deleted.
       
       In this manual, the login node corresponds to the remote system, henceforth referred to as the login node. The terminal corresponding to the local system is called the client machine.


Use environment
---------------

| The integrated development environment uses Eclipse installed on the local machine.
| The local machine must be able to connect to the login node via SSH, and must meet the Eclipse operating environment.


[Operation confirmed environment]

.. list-table::
  :header-rows: 1
  :widths: 3 3 3
  
  * - Operation System(OS)
    - Java Runtime Environment (JRE)/Java Development Kit (JDK)
    - Eclipse IDE for Scientific Computing

  * - Microsoft Windows 11 (64bit)
    - OpenJDK 8 (1.8.0.332-1)
    - Eclipse IDE 2020-06 R Packages

  * - macOS Catalina
    - OpenJDK 8 (1.8.0.332-1)
    - Eclipse IDE 2020-06 R Packages

  * - Red Hat Enterprise Linux 8.1
    - OpenJDK 8 (1.8.0.332-1)
    - Eclipse IDE 2020-06 R Packages

.. attention::

   It is your responsibility to obtain (https://github.com/ojdkbuild) and use the JRE/JDK upon thorough review of the terms of use (license conditions).

Instalation direction
---------------------

This section describes the procedure for installing the integrated development environment.
  

Installation of Eclipse
~~~~~~~~~~~~~~~~~~~~~~~

This indicates how to install Eclipse.

.. contents::
   :local:

Installation of JRE or JDK
^^^^^^^^^^^^^^^^^^^^^^^^^^

 To use Eclipse, installation of JRE(Java Runtime Environment) or JDK(Java Development Kit) is required, please install beforehand.

 .. seealso::
   
   Please refer to the following website about the required version of JRE/JDK to use Eclipse IDE.
   
   https://wiki.eclipse.org/Eclipse/Installation


Installation of Eclipse
^^^^^^^^^^^^^^^^^^^^^^^

 From Eclipse Foundation official website, install "Eclipse IDE for Scientific Computing" to preferred place.
 
 To install, there are two ways : Downloading "Eclipse IDE for Scientific Computing" from the official website or select "Eclipse IDE for Scientific Computing" on installing package selection screen by using Eclipse Installer.

 .. seealso::
 
   For more details, please refer to the following Eclipse Foundation official website.
   
   https://www.eclipse.org/

Start Eclipse
^^^^^^^^^^^^^

1. Execute ``eclipse`` in the install folder.

   Eclipse starts and the screen of specifying work space is shown. Specify the directory where you want to create a work space to [Workspace]. If specified directory doesn't exist, it will be created automatically. After setting [Workspace], click on [Launch].

 .. figure:: ./img/DevelopmentSupportToolsInstallEclipse_01.png

2. If [Welcome] view is displayed, it is not used so please close the view.

 .. figure:: ./img/DevelopmentSupportToolsInstallEclipse_02.png

3. Initial screen is shown.

 .. figure:: ./img/DevelopmentSupportToolsInstallEclipse_03.png


Installation of Fujitsu extensiton function
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

We describe about how to install Fujitsu extention function.

This work should be executed when creating a new of Eclipse work space.

.. contents::
   :local:


.. _DevelopmentSupportToolsInstallFujitsuExtensionRemoteServer:

Connect to login node
^^^^^^^^^^^^^^^^^^^^^

| Proceed setting to connect login node.
| For Integrated development environment, use login node as a remote server.

You must create a private SSH key in advance to use when connecting to the login node.
See :ref:`Private key/Public key creation for Eclipse <DevelopmentSupportToolGeneratingPrivateKeyAndPublicKey>`.

1. From Eclipse menu bar, select :menuselection:`[Window] --> [Preference]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionRemoteServer_01.png
     :align: center

2. From [Preferences] screen's left-paine, select :menuselection:`[General] --> [Network Connections] --> [SSH2]` and register the private key in Eclipse.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionPrivatekey_01.png
     :align: center

 .. list-table::
   :header-rows: 1
   :widths: 2 6
   
   * - Item
     - Value
   
   * - SSH2 home
     - Click [Browse...] button and select the path that contains the private key.
          
   * - Private keys
     - Click [Add Private Key...] button and enter the file name of the private key.

 .. attention:: 

  - | Please use the private key of ECDSA (NIST P 521). Ed25519 and RSA private keys cannot be used in eclipse.
    | If eclipse is using RSA key, you will not be able to connect to the login node in the future.
  - When recreating the private key and public key pair, the public key registration is required. For details, please refer to "4.4.2 Public key registration" in Users Guide - Use and job execution -.

3．Select :guilabel:`[Apply and Close]`. 

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionPrivatekey_02.png
     :align: center

4. From Eclipse menu bar, select :menuselection:`[Window] --> [Preference]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionRemoteServer_01.png

5. From [Preferences] screen's left-paine, select :menuselection:`[Remote Development] --> [Remote Connections]` and click on :guilabel:`[Add]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionRemoteServer_02.png

6. Set the required information to [New Connection] screen and click on :guilabel:`[Finish]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionRemoteServer_03.png


 [New Connection] screen setting contents are as following.

 .. list-table::
    :header-rows: 1
    :widths: 2 3 4
    
    * - Item 1
      - Item 2
      - Setting contents

    * - Connection name
      - 
      - Specifies [Remote Connection] identification name. Specify the preferred name.

    * - Host information
      - Host
      - Specifies login node's host name ``login.fugaku.r-ccs.riken.jp``.

    * - Host information
      - User
      - Specifies login user name to login node.

    * - Host information
      - | ・Public key based authentication
        | ・Password based authentication
      - Selects the authentication firection to use when connecting to login node.
        
        - | Public key based authentication
        - | Passphrase
          | Input the passphrase of your private key.

    * - Host information
      - Advanced
      - Extended setting. please set on demand.

7. Confirm if the setting contents to [Remote Connections] is added.
   
   Select the added setting and click on :guilabel:`[Open]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionRemoteServer_04.png

8. Make sure that the Status is refeshed as "open" and click :guilabel:`[Apply and Close]` then close the screen.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionRemoteServer_05.png


.. _DevelopmentSupportToolsInstallFujitsuExtensionArrangement:

Arrangement of Fujitsu extention function file
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Arrange the required file to use Fujitsu entention function.

 The required file to use Fujitsu extention function is stored in login node as below.

 .. code-block:: none

   $FJSVXTCLANGA/misc/ide/idefiles.zip


 The construction in the above ide directory is as following.

 .. list-table::
   :header-rows: 1
   :widths: 3 7 3
   
   * - Directory name/File name
     - Description
     - storage location
   
   * - eclipsesetting
     - File to arrange under login node's :file:`/home/groupname/username/.eclipsesettings`  is stored.
     - login node
   
   * - plugins
     - The file to arrange in Eclipse's plugins folder is stored.
     - Client machine
   
   * - fj_extention
     - XML file to use in  \ :ref:`DevelopmentSupportToolsInstallFujitsuExtensionFileImport`\  is stored.
     - Client machine

[How to arrange file]

 | Arrange file as following steps.
 | Arranging file is requred work in the both of login node and client machine.

 1. Expand the :file:`idefiles.zip`\ file to any location on the login node.

 2. Rename the :file:`eclipsesettings`\ directory to the :file:`.eclipsesettings` derectory and copy it directly under the \ :file:`/home/groupname/username/`\ directory on the login node.

 3. Transfer the :file:`idefiles.zip`\ file to the client machine and extract it to any location.


.. _DevelopmentSupportToolsInstallFujitsuExtensionFileImport:

Import of  of Fujitsu extention function file
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Import the required setting file to use Fujitsu extension function to Eclipse.


1. Display [Project Explorer] view. [Project Explorer] view can be displayed by selecting menu bar's :menuselection:`[Window] --> [Show View] --> [Project Explorer]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionFileImport_01.png
      :align: center

2. Select menu bar's :menuselection:`[Files] --> [Import...]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionFileImport_02.png
      :align: center

3. From [Import] screen's Select an import wizard, select :menuselection:`[Target System Configrations] --> [Target Configration from Plug-in]` and click on :guilabel:`[Next>]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionFileImport_03.png
      :align: center

4. From pull-down menu, select [Generic PBS Batch] and click on :guilabel:`[Finish]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionFileImport_04.png
      :align: center

5. On targetConfiguratons project creation selection screen, click on :guilabel:`[Yes]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionFileImport_05.png
      :align: center

6. Make sure that [targetConfigurations] is added on [Project Explorer] view and select [targetConfigurations].

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionFileImport_06.png
      :align: center

7. From menu bar, select :menuselection:`[File] --> [Import...]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionFileImport_07.png
      :align: center

8. On [Import] screen,  select :menuselection:`[General] --> [File System]` and click on :guilabel:`[Next >]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionFileImport_08.png
      :align: center

9. | click on right side of [From directory] 's [Browse...], specify  :file:`fj_extention` directory  expanded in :ref:`DevelopmentSupportToolsInstallFujitsuExtensionArrangement`. After specification, the selected directory and the files in the directory are displayed in the box below.
   | Put check in the :file:`FUJITSU_Technical_Computing_Suite.xml` file of right side of the box and confirm that "targetConfigrations" is specified at [Info folder] under box.
   | If "targetConfigrations" is not specified, click on [Browse...] on right side and select "targetConfigrations" from [Import into Folder] screen. After setting is done, click on  [Finish].

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionFileImport_09.png
      :align: center

10. To [Project Explorer] view's [targetConfigurations], confirm if :file:`FUJITSU_Technical_Computing_Suite.xml` is added.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionFileImport_10.png
      :align: center

11. [Project Explorer] view's :file:`Generic PBS Batch (1).xml` is no longer used, so from [Project Exploler] view, right-click on :file:`GenericSLURM Batch (1).xml` and select [Delete] and delete.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionFileImport_11.png
      :align: center

12. Check if there is no problem on the confirmation screen and click on [OK].

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionFileImport_12.png
      :align: center


Applying the Installation Package
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

1. Click :menuselection:`[Window] --> [Preferences]` on the menu bar.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_01.png
     :align: center

2. Select [Install/Update] from the left pane in the [Preferences] window, uncheck [Verify provisioning operation is compatible with currently running JRE], and click the :guilabel:`[Apply]` button.
 
 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_02.png
     :align: center

3. Expand [Install/Update] from the left pane in the [Preferences] window and select [Available Software Sites]. Uncheck all checkboxes under [Name] and click the :guilabel:`[Apply and Close]` button.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_03.png
     :align: center

 .. attention:: 

  | Do not apply updates to the software installed in Eclipse. 
  | Also, do not install new software in Eclipse except the one described in this section.

4. Click :menuselection:`[Help] --> [Install New Software]` on the menu bar.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_04.png
     :align: center

5. Click the :guilabel:`[Add]` button in the [Install] window.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_05.png
     :align: center

6. Set the necessary information in the [Add Repository] window, and click the :guilabel:`[Add]` button.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_06.png
     :align: center

 .. list-table::
    :header-rows: 1
    :widths: 2 6
    
    * - Item Name
      - Setting Details

    * - Name
      - Specify an arbitrary name.

    * - Location
      - Click the [Archive] button, and select the installation package TCS_IDE_Plugins_YYYYMMDDhhmm.zip, which is located in a local directory. 
        The installation package is stored in the "patches" directory of files for Fujitsu extended functions.

7. The window displays a list of software that can be applied to Eclipse. Click the [Select All] button to select all, and click the :guilabel:`[Next]` button.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_07.png
     :align: center

8. Select [Update my installation to be compatible with the items being installed], and click :guilabel:`[Next]`.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_08.png
     :align: center

9. The window displays the software to be installed. Confirm that "Parallel Tools PlatForm with TCS patches" and "Toolchain-feature" are to be installed, and click the :guilabel:`[Next]` button.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_09.png
     :align: center

10. Select [I accept the terms of the license agreement], and click the :guilabel:`[Finish]` button.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_10.png
     :align: center

11. The security warning screen appears. Click the :guilabel:`[Install anyway]` button.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_11.png
     :align: center

12. | You are asked whether to restart the IDE. Click the :guilabel:`[No]` button. 
    | Then click the X button in the upper right corner of Eclipse to exit Eclipse.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_12.png
     :align: center

13. | Confirm that the software is correctly installed in Eclipse. 
    | Click :menuselection:`[Help] --> [About Eclipse IDE] --> [Installation Details]` on the menu bar. Confirm that the list on the [Installed Software] tab includes the two specified software names.

 .. figure:: ./img/DevelopmentSupportToolsInstallFujitsuExtensionApplyPackage_13.png
     :align: center

 .. seealso:: 

   If you don't see the softwares, try the following:
  
   - Start Eclipse by using "eclipse -clean" from the terminal or command prompt, and confirm [Installed Software].

.. _DevelopmentSupportToolGeneratingPrivateKeyAndPublicKey:

Private key/Public key creation for Eclipse
-------------------------------------------

Provides step-by-step instructions on how to create an ECDSA key pair (public/private). You must install the terminal emulator PuTTY (Patty) before using puttygen.


.. contents::
   :local:

Creating a Key Pair Using ssh-keygen
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Execute a command ssh-keygen on the user’s device, create a private/public key pair.

1. Start terminal and execute a command :command:`ssh-keygen`.

  - If Windows, start command prompt (:menuselection:`Windows System tools --> command prompt`
  - If Mac(OS X), start Terminal(:menuselection:`Application --> Utility --> Terminal`) and execute a command ssh-keygen.
  - If UNIX/Linux, start terminal emulator and execute a command :command:`ssh-keygen`.


  .. code-block:: console

    [terminal]$ ssh-keygen -t ecdsa -b 521 -m PEM
    Generating public/private ecdsa key pair.
    Enter file in which to save the key (C:\Users\name/.ssh/id_ecdsa):
    Enter passphrase (empty for no passphrase): # Enter passphrase
    Enter same passphrase again:                # Re-enter the same passphrase
    Your identification has been saved in C:\Users\name/.ssh/id_ecdsa.
    Your public key has been saved in C:\Users\name/.ssh/id_ecdsa.pub.
    The key fingerprint is:
    SHA256:fMxUePmrQnAzHlQw531SdYV+hFD0iChkVf1cuXuVEuw name@hostname
    The key's randomart image is:
    +---[ECDSA 521]---+
    |        o.+=B*ooO|
    |       o  o*o=+=+|
    |        ..o.+o=+*|
    |       ..==  Eo==|
    |        S+++  .oo|
    |         .o   ...|
    |         .   .  .|
    |          . .    |
    |           .     |
    +----[SHA256]-----+


  .. note::

    - Set a passphrase that is difficult for others to guess, just like a password. Please be sure to set a passphrase. We recommend a passphrase length of at least 15 characters.

2. | Once execute :command:`ssh-keygen`, two types are created: a private key (id_ed25519) and a public key (id_ed25519.pub) on :file:`.ssh` directory under the home directory.
   | Register the public key (id_ed25519.pub) in the login node using the Fugaku website.
   | Register the private key (id_ed25519) in the Eclipse.


Creating a Key Pair Using PuTTYgen
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Create a private/public key using :command:`puttygen`.

1. | Start :command:`puttygen`.
   | Select :guilabel:`"ECDSA"` for type of key to generate and :guilabel:`"nistp521"`, then click :guilabel:`"Generate"`.

  .. figure:: ./img/DevelopmentSupportToolGeneratingPrivateKeyAndPublicKey_01.png
     :scale: 70
     :align: center

2. Move the mouse cursor randomly.

  .. figure:: ./img/DevelopmentSupportToolGeneratingPrivateKeyAndPublicKey_02.png
     :scale: 70
     :align: center

3. | Save the public key.
   | Copy the displayed contents on "Public key for pasting in to OpenSSH authorized_keys file:" to the clip board (It is recommended to paste on the notepad).
   | The contents pasted on the clip board (Public key) is registered with using the Fugaku website.


  .. figure:: ./img/DevelopmentSupportToolGeneratingPrivateKeyAndPublicKey_03.png
     :scale: 70
     :align: center

4. Input a passphrase to both "Key passphrase" and "Confirm passphrase". After inputting, click :guilabel:`"Save private key"` and save the private key. The file saved here is used when you want to reconfirm the public key.

  .. figure:: ./img/DevelopmentSupportToolGeneratingPrivateKeyAndPublicKey_04.png
     :scale: 70
     :align: center

  .. Attention::

    Set a passphrase that is difficult for others to guess, just like a password. Please be sure to set a passphrase. We recommend a passphrase length of at least 15 characters.

5. Select :menuselection:`[Conversions] --> [Export OpenSSH key]` to save the private key in a file in a format that can be used by Eclipse.

  .. figure:: ./img/DevelopmentSupportToolGeneratingPrivateKeyAndPublicKey_05.png
     :scale: 70
     :align: center

6. Enter the filename where you want to store the private key in "File name (N)" and click the :guilabel:`"Save(S)"` button. The private key is stored. Eclipse uses the filename you enter here.

  .. figure:: ./img/DevelopmentSupportToolGeneratingPrivateKeyAndPublicKey_06.png
     :scale: 70
     :align: center
