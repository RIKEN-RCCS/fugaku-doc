

<!doctype html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3.1.11.2. Advanced Performance Profiler &#8212; Supercomputer Fugaku User Guide －Language and development environment－  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bizstyle.css?v=532c1bf3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=f85107c5" />
    
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/bizstyle.js"></script>
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="3.1.11.3. Instant Performance Profiler" href="InstantProfiler.html" />
    <link rel="prev" title="3.1.11.1. Overview" href="Overview.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="InstantProfiler.html" title="3.1.11.3. Instant Performance Profiler"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="Overview.html" title="3.1.11.1. Overview"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Supercomputer Fugaku User Guide －Language and development environment－  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" ><span class="section-number">3. </span>Compilers that generate binaries for compute nodes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" ><span class="section-number">3.1. </span>Fujitsu compiler</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" accesskey="U"><span class="section-number">3.1.11. </span>Profiler</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.1.11.2. </span>Advanced Performance Profiler</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="advanced-performance-profiler">
<h1><span class="section-number">3.1.11.2. </span>Advanced Performance Profiler<a class="headerlink" href="#advanced-performance-profiler" title="Link to this heading">¶</a></h1>
<p>The Advanced Performance Profiler measures and outputs the execution performance information of the specified section of the application.</p>
<section id="overview">
<h2><span class="section-number">3.1.11.2.1. </span>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Advanced Performance Profiler is composed of 2 commands: <strong class="program">fapp</strong> command that measures profiler data and <strong class="program">fapppx</strong> command that output the profile result from measured data. The information that the Advanced Performance Profiler measures and outputs is as follows.</p>
<ul class="simple">
<li><p>Statistical time information</p></li>
<li><p>MPI communication cost information</p></li>
<li><p>CPU performance analysis information</p></li>
</ul>
<p>The flow of using the Advanced Performance Profiler is as follows.</p>
<figure class="align-default">
<img alt="../../../_images/AdvancedProfiler_01.png" src="../../../_images/AdvancedProfiler_01.png" />
</figure>
</section>
<section id="addition-of-measurement-interval-specification-routine">
<h2><span class="section-number">3.1.11.2.2. </span>Addition of measurement interval specification routine<a class="headerlink" href="#addition-of-measurement-interval-specification-routine" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">Adds measurement interval specification routines / functions necessary for specifying the interval for measuring profile data to the source code.</div>
<div class="line">The measurement interval specification function can be used as a Fortran language subroutine or C/C++ function.</div>
<div class="line">When using C/C++ functions, you must declare the function prototype or include the header file of the profiler subroutine.</div>
</div>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 22.2%" />
<col style="width: 22.2%" />
<col style="width: 22.2%" />
<col style="width: 22.2%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Language type</p></th>
<th class="head"><p>Header file</p></th>
<th class="head"><p>Sub routine / function name</p></th>
<th class="head"><p>Argument</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Fortran</p></td>
<td><p>None</p></td>
<td><div class="line-block">
<div class="line">fapp_start</div>
<div class="line">fapp_stop</div>
</div>
</td>
<td><p>(name, number, level)</p></td>
<td><div class="line-block">
<div class="line">Start measuring information</div>
<div class="line">End measuring information</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>C/C++</p></td>
<td><p>fj_tool/fapp.h</p></td>
<td><div class="line-block">
<div class="line">void fapp_start</div>
<div class="line">void fapp_stop</div>
</div>
</td>
<td><p>(const char *name, int number, int level)</p></td>
<td><div class="line-block">
<div class="line">Start measuring information</div>
<div class="line">End measuring information</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>[Argument details]</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 80.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>name</p></td>
<td><p>Group name (basic character scalar). A group name consists of letters, numbers, and underscores. Other characters cannot be used.</p></td>
</tr>
<tr class="row-odd"><td><p>number</p></td>
<td><p>Detail number (4-byte integer type)</p></td>
</tr>
<tr class="row-even"><td><p>level</p></td>
<td><p>Priority level (4-byte integer type 0 or greater integer)</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The group name and detail number are used to distinguish them as measurement range names. If the priority level is higher than <strong class="program">fapp</strong> command’s <code class="docutils literal notranslate"><span class="pre">-L</span></code> option, do not proceed measurement.</p>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<ul class="simple">
<li><p>When calling subroutines / functions with the same measurement section name multiple times, be sure to call them in the order fapp_start and fapp_stop. If fapp_start is called again before calling fapp_stop, or if fapp_stop is called before calling fapp_start, a warning message is output and the call is ignored.</p></li>
<li><p>If the measurement section names are different, there is no problem if fapp_start or fapp_stop continues.</p></li>
<li><p>If the process ends without calling fapp_stop, the profile data for that section is not measured.</p></li>
<li><p>If the measurement for the same measurement section name is performed multiple times, all the measurement results are added.</p></li>
<li><p>Specify the same value for the argument level for fapp_start and fapp_stop. If you specify a different value, depending on specification of <strong class="program">fapp</strong> command’s  <code class="docutils literal notranslate"><span class="pre">-L</span></code>  option , unintended results may occur.</p></li>
<li><p>If specify “all” to argument <code class="docutils literal notranslate"><span class="pre">name</span></code> and 0 to <code class="docutils literal notranslate"><span class="pre">number</span></code>,it covers the entire program.</p></li>
<li><p>In the case of an MPI program, call a subroutine / function with the same measurement section name in all processes to be measured. Profile data for processes that have not been called is not counted.</p></li>
</ul>
</div>
</div></blockquote>
<p>An example of using the measurement interval specification routine is shown below.</p>
<ul>
<li><p>Fortran example</p>
<ol class="arabic simple">
<li><p>Sample specification example</p></li>
</ol>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">program </span><span class="n">main</span>
<span class="p">...</span>
<span class="k">call </span><span class="n">fapp_start</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">         </span><span class="c">! Start measurement of measurement section name &quot;foo1&quot;</span>
<span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">call </span><span class="n">fapp_start</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">       </span><span class="c">! Start measurement of measurement section name &quot;bar1&quot;</span>
<span class="w">  </span><span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span>
<span class="w">   </span><span class="p">...</span>
<span class="w">  </span><span class="k">end do</span>
<span class="k">  call </span><span class="n">fapp_stop</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">        </span><span class="c">! End measurement of measurement section name &quot;bar1&quot;</span>
<span class="k">end do</span>
<span class="k">call </span><span class="n">fapp_stop</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">          </span><span class="c">! End measurement of measurement section name &quot;foo1&quot;</span>
<span class="k">end program </span><span class="n">main</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Example of measuring all processes (measurement starts before calling the mpi_init subroutine)</p></li>
</ol>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">fapp_start</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">         </span><span class="c">! Start measurring</span>
<span class="k">call </span><span class="n">mpi_init</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="p">...</span>
<span class="k">call </span><span class="n">mpi_finalize</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">call </span><span class="n">fapp_stop</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">          </span><span class="c">! End measurring</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Example of measuring all processes (measurement starts immediately after calling the mpi_init subroutine)</p></li>
</ol>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">mpi_init</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">call </span><span class="n">fapp_start</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">         </span><span class="c">! Start measurring</span>
<span class="p">...</span>
<span class="k">call </span><span class="n">fapp_stop</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">          </span><span class="c">! End measurring</span>
<span class="k">call </span><span class="n">mpi_finalize</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Example of measuring only process 0</p></li>
</ol>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">mpi_init</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">mpi_comm_world</span><span class="p">,</span><span class="n">rank</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<span class="k">if</span><span class="p">(</span><span class="n">rank</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">  call </span><span class="n">fapp_start</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">       </span><span class="c">! Only process 0, start measurring</span>
<span class="k">end if</span>
<span class="w">  </span><span class="p">...</span>
<span class="k">if</span><span class="p">(</span><span class="n">rank</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">  call </span><span class="n">fapp_stop</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">        </span><span class="c">! Only process 0, end measurring</span>
<span class="k">end if</span>
<span class="k">call </span><span class="n">mpi_finalize</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>C/C++ example</p>
<ol class="arabic simple">
<li><p>Sample specification example</p></li>
</ol>
<blockquote>
<div><div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;fj_tool/fapp.h&quot;</span><span class="c1">          // Include header file</span>
<span class="p">...</span>
<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">;</span>
<span class="w">  </span><span class="n">fapp_start</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">           </span><span class="c1">// Start measuring the measurement section name &quot;foo1&quot;</span>
<span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10000</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">fapp_start</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">         </span><span class="c1">// Start measuring the measurement section name &quot;bar1&quot;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">10000</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
<span class="w">       </span><span class="p">...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">fapp_stop</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">          </span><span class="c1">// End measuring the measurement section name &quot;bar1&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">fapp_stop</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">            </span><span class="c1">// End measuring the measurement section name &quot;foo1&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Example of measuring all processes (start measurement before calling the MPI_Init function)</p></li>
</ol>
<blockquote>
<div><div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">fapp_start</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">             </span><span class="c1">// Start measurring</span>
<span class="n">MPI_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">MPI_Finalize</span><span class="p">();</span>
<span class="n">fapp_stop</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">              </span><span class="c1">// End measurring</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Example of measuring all processes (measurement starts immediately after calling the MPI_Init function)</p></li>
</ol>
<blockquote>
<div><div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">MPI_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>
<span class="n">fapp_start</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">             </span><span class="c1">// Start measurring</span>
<span class="p">...</span>
<span class="n">fapp_stop</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">              </span><span class="c1">// End measurring</span>
<span class="n">MPI_Finalize</span><span class="p">();</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Example of measuring only process 0</p></li>
</ol>
<blockquote>
<div><div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">MPI_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>
<span class="n">MPI_Comm_rank</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rank</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">rank</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
<span class="w">  </span><span class="n">fapp_start</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">           </span><span class="c1">// Only process 0, start measurring</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="k">if</span><span class="p">(</span><span class="n">rank</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
<span class="w">  </span><span class="n">fapp_stop</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">            </span><span class="c1">// Only process 0, end measurring</span>
<span class="p">}</span>
<span class="n">MPI_Finalize</span><span class="p">();</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</section>
<section id="compiling-linking">
<h2><span class="section-number">3.1.11.2.3. </span>Compiling / Linking<a class="headerlink" href="#compiling-linking" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">The tool library required to use the Instant Performance Profiler function is linked by default when compiling / linking.</div>
<div class="line">Therefore, there is no need to specify special options as in the following example.</div>
<div class="line">Compile / link is done at the login node or the compute node.</div>
</div>
<ul class="simple">
<li><p>Compile / link example (MPI program)</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[_LNlogin]$ </span>mpifrtpx<span class="w">  </span>-Kfast,parallel<span class="w">  </span><span class="s2">&quot;Source file name&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Compile / link example (sequential / thread parallel program)</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[_LNlogin]$ </span>$<span class="w"> </span>frtpx<span class="w">  </span>-Kfast,parallel<span class="w">  </span><span class="s2">&quot;Source file name&quot;</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>When split compilation is performed, the optimization options specified at compile time should also be specified at link time so that the library of the appropriate profiler is linked.</p>
<p>For programs using OpenMP, specify <code class="docutils literal notranslate"><span class="pre">-Kopenmp</span></code> option when linking.</p>
</div>
</div></blockquote>
<section id="about-fortran-translation-options">
<h3><span class="section-number">3.1.11.2.3.1. </span>About Fortran translation options<a class="headerlink" href="#about-fortran-translation-options" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">The following are the translation options for the profiler used when translating Fortran programs.</div>
<div class="line">This option is enabled when linking.</div>
</div>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-Nfjprof</p></td>
<td><div class="line-block">
<div class="line">Combine tool library.</div>
<div class="line">When omitted, <code class="docutils literal notranslate"><span class="pre">-Nfjprof</span></code> is enabled.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>-Nnofjprof</p></td>
<td><div class="line-block">
<div class="line">Do not combine tool library.</div>
<div class="line">Cannot use profiler.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="about-c-c-translation-options">
<h3><span class="section-number">3.1.11.2.3.2. </span>About C/C++ translation options<a class="headerlink" href="#about-c-c-translation-options" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">For the C/C++ language, there are two types of compilation modes: trad mode and clang mode.</div>
<div class="line">The translation options for the profiler used when translating programs in each mode are listed below.</div>
<div class="line">This option is enabled when linking.</div>
</div>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 14.3%" />
<col style="width: 28.6%" />
<col style="width: 57.1%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Mode</p></th>
<th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>trad</p></td>
<td><p>-Nfjprof</p></td>
<td><div class="line-block">
<div class="line">Combine tool library.</div>
<div class="line">When omitted <code class="docutils literal notranslate"><span class="pre">-Nfjprof</span></code> is enabled.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>trad</p></td>
<td><p>-Nnofjprof</p></td>
<td><div class="line-block">
<div class="line">Do not combine tool library.</div>
<div class="line">Cannot use profiler.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>clang</p></td>
<td><p>-ffj-fjprof</p></td>
<td><div class="line-block">
<div class="line">Combine tool library.</div>
<div class="line">When omitted <code class="docutils literal notranslate"><span class="pre">-ffj-fjprof</span></code> is enabled.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>clang</p></td>
<td><p>-ffj-no-fjprof</p></td>
<td><div class="line-block">
<div class="line">Do not combine tool library.</div>
<div class="line">Cannot use profiler.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
</section>
<section id="measurement-of-profile-data">
<h2><span class="section-number">3.1.11.2.4. </span>Measurement of profile data<a class="headerlink" href="#measurement-of-profile-data" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">Here is an example shell script for running the Advanced Profiler.</div>
<div class="line">In the example shown here, CPU performance analysis information and MPI communication cost information are measured. For details, see “Profiler User’s Guide”.</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -x</span>
<span class="c1">#</span>
<span class="c1">#PJM -L &quot;node=8&quot;</span>
<span class="c1">#PJM -L &quot;elapse=01:00:00&quot;</span>
<span class="c1">#PJM -x PJM_LLIO_GFSCACHE=/vol000N</span>
<span class="c1">#PJM -g groupname</span>
<span class="c1">#PJM -s</span>
<span class="c1">#</span>

<span class="nv">LD</span><span class="o">=</span><span class="s2">&quot;./sample_mpi&quot;</span>
<span class="nv">MPIEXEC</span><span class="o">=</span><span class="s2">&quot;mpiexec&quot;</span>
<span class="c1">#</span>
fapp<span class="w"> </span>-C<span class="w"> </span>-d<span class="w"> </span>./tmp<span class="w"> </span>-Icpupa,mpi<span class="w"> </span>-Hevent<span class="o">=</span>statistics<span class="w"> </span><span class="si">${</span><span class="nv">MPIEXEC</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">LD</span><span class="si">}</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>If proceed the following to the profiler data that is measured by <strong class="program">fapp</strong> command, we do not guarantee the work result.</p>
<ul class="simple">
<li><p>Edit profile data</p></li>
<li><p>Add, delete, and rename profile data</p></li>
</ul>
</div>
</section>
<section id="profiler-option">
<h2><span class="section-number">3.1.11.2.5. </span>Profiler option<a class="headerlink" href="#profiler-option" title="Link to this heading">¶</a></h2>
<p>We describe <strong class="program">fapp</strong> command option.</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">-C</div>
<div class="line">(Required option)</div>
</div>
</td>
<td><p>Specifies measurement of profile data. If this option is omitted, an error message is output and the execution of the program ends.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">-d  <em>profile_data</em></div>
<div class="line">(Required option)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Specify the directory for storing profile data. If this option is omitted, an error message is output and the execution of the program ends.</div>
<div class="line">In <code class="docutils literal notranslate"><span class="pre">profile_data</span></code>, specify the directory name for storing the profile data as a relative or absolute path. The specified directory must be new or empty.</div>
<div class="line">When analyzing a program that moves the current directory during execution, <code class="docutils literal notranslate"><span class="pre">profile_data</span></code> is specified as an absolute path.</div>
<div class="line">The Profiler creates a subdirectory for every 1000 files under <code class="docutils literal notranslate"><span class="pre">profile_data</span></code>. Therefore, even for large jobs, you only need to specify <code class="docutils literal notranslate"><span class="pre">profile_data</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>-H<em>item</em></p></td>
<td><div class="line-block">
<div class="line">Specify the measurement of CPU performance analysis information.</div>
<div class="line">If  <code class="docutils literal notranslate"><span class="pre">-Inocpupa</span></code> option is specified, a warning message is output and this option is disabled.</div>
<div class="line"><em>item</em>:{event=<em>event</em> | event_raw=<em>event_raw</em> } [,method={fast | normal},mode={all | user}]</div>
</div>
<dl>
<dt>event=<em>event</em></dt><dd><p>Measures information used for CPU Performance Analysis Reports. Specify one of the following for <em>event</em> .</p>
<p>{ pa1 | pa2 | pa3 | pa4 | pa5 | pa6 | pa7 | pa8 | pa9 | pa10 | pa11 | pa12 | pa13 | pa14 | pa15 | pa16 | pa17 | statistics}</p>
</dd>
<dt>event_raw=<em>event_raw</em></dt><dd><p>CPU performance analysis information is measured by specifying the event number of PMU event information. <em>event_raw</em> specifies the event number corresponding to the CPU in decimal or hexadecimal notation. Up to 8 <em>event_raw</em> can be specified by separating them with a comma (,).</p>
</dd>
<dt>method=fast</dt><dd><p>Specify the measurement method for CPU performance analysis information. When this suboption is specified, high-precision CPU performance analysis information is measured by a method that directly measures hardware information.</p>
</dd>
<dt>method=normal</dt><dd><p>Specify the measurement method for CPU performance analysis information. When this suboption is specified, CPU performance analysis information is measured by the method of measuring via the OS. When omitted, it will be  <code class="docutils literal notranslate"><span class="pre">method=normal</span></code>.</p>
</dd>
<dt>mode=all</dt><dd><p>Specify the measurement mode for CPU performance analysis information. When this suboption is specified, performance is measured in kernel mode and user mode.</p>
</dd>
<dt>mode=user</dt><dd><p>Specify the measurement mode for CPU performance analysis information. When this suboption is specified, performance measurement is performed in user mode.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">-I<em>item</em></div>
<div class="line">(Hyphen + capital letter I)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Specify the items to be measured by the Advanced Performance Profiler. If specify with multiple  <em>item</em>, devide with comma.</div>
<div class="line"><em>item</em> :{{<code class="docutils literal notranslate"><span class="pre">cpupa</span></code> | <code class="docutils literal notranslate"><span class="pre">nocpupa</span></code>} | {<code class="docutils literal notranslate"><span class="pre">mpi</span></code> | <code class="docutils literal notranslate"><span class="pre">nompi</span></code>}}</div>
</div>
<div class="line-block">
<div class="line">Operation when this option is omitted depends on the item to be measured.</div>
<div class="line">For CPU performance characteristics measurement, if  <code class="docutils literal notranslate"><span class="pre">-H</span></code> option is specified,  <code class="docutils literal notranslate"><span class="pre">-Icpupa</span></code> is enabled, if  <code class="docutils literal notranslate"><span class="pre">-H</span></code> option is not specified,  <code class="docutils literal notranslate"><span class="pre">-Inocpupa</span></code> is enabled.</div>
<div class="line">For MPI Cost information measurement, if target is MPI program, <code class="docutils literal notranslate"><span class="pre">mpi</span></code> is enabled, if target is unti MPI program, <code class="docutils literal notranslate"><span class="pre">nompi</span></code> is enabled.</div>
</div>
<dl class="simple">
<dt>cpupa:</dt><dd><p>Measures the CPU performance characteristics.</p>
</dd>
<dt>nocpupa:</dt><dd><p>Do not measures the CPU performance characteristics.</p>
</dd>
<dt>mpi:</dt><dd><p>Measures MPI Cost information.</p>
</dd>
<dt>nompi:</dt><dd><p>Does not measures MPI Cost information.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><p>-L <em>level</em></p></td>
<td><div class="line-block">
<div class="line">Specify the start level of the measurement target.</div>
<div class="line">For level, specify an integer value in the range of 0 to 2,147,483,647. This option has meaning for the third argument level of the measurement section specification routine. “level”&gt; = “Only the section of the third argument level” of the measurement section specification routine is enabled as a measurement target.</div>
<div class="line">When this option is omitted,  <code class="docutils literal notranslate"><span class="pre">-L</span> <span class="pre">0</span></code> is enabled.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>exec-file [ exec_option … ]</p></td>
<td><p>Specify the executable file and options for profile data measurement. For MPI programs, specify from  <strong class="program">mpiexec</strong>.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="output-profile-result">
<span id="advancedprofileroutputprofileresults"></span><h2><span class="section-number">3.1.11.2.6. </span>Output profile result<a class="headerlink" href="#output-profile-result" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">To output Advanced Performance Profiler information by inputting created data by  <strong class="program">fapp</strong> command, use  <strong class="program">fapppx</strong> command.</div>
<div class="line">Perform this operation on the login node.</div>
</div>
<p>An execution example is shown below of  <strong class="program">fapppx</strong> command.</p>
<ul class="simple">
<li><dl class="simple">
<dt>If it’s login node</dt><dd><p>Use  <strong class="program">fapppx</strong> command.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>If it’s computing node</dt><dd><p>Use  <strong class="program">fapp</strong> command.</p>
</dd>
</dl>
</li>
</ul>
<p>[Command execution example]</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[_LNlogin] $ </span>fapppx<span class="w"> </span>-A<span class="w"> </span>-pall<span class="w"> </span>-o<span class="w"> </span>tmp.txt<span class="w"> </span>-d<span class="w"> </span>Fprofd_stati
</pre></div>
</div>
<p>In this example, output of all process information is specified ( <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">all</span></code>).
Also,  it is able to output the input file used for the CPU Performance Analysis Report to  <code class="docutils literal notranslate"><span class="pre">-tcsv</span></code> option.</p>
<section id="fapppx-command-option">
<h3><span class="section-number">3.1.11.2.6.1. </span>fapppx command option<a class="headerlink" href="#fapppx-command-option" title="Link to this heading">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 27.3%" />
<col style="width: 72.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Function / measurement value (unit)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">-A</div>
<div class="line">(Required option)</div>
</div>
</td>
<td><p>Specify output processing of profile results.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">-d  <em>profile_data</em></div>
<div class="line">(Required option)</div>
</div>
</td>
<td><p>Specify the directory where the profile data is stored in <em>profile_data</em> as a relative or absolute path.</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">-I<em>item</em></div>
<div class="line">(Hyphen + capital letter I)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Specify the items to be output as profile results.</div>
<div class="line">f specify the multiple  <em>item</em>, devide with comma.</div>
<div class="line">item:{{<code class="docutils literal notranslate"><span class="pre">cpupa</span></code> | <code class="docutils literal notranslate"><span class="pre">nocpupa}|</span></code>} | {<code class="docutils literal notranslate"><span class="pre">mpi</span></code> | <code class="docutils literal notranslate"><span class="pre">nompi</span></code>}}</div>
</div>
<dl class="simple">
<dt>cpupa:</dt><dd><p>Output the CPU performance characteristics. When omitted  <code class="docutils literal notranslate"><span class="pre">cpupa</span></code> is enabled.</p>
</dd>
<dt>nocpupa:</dt><dd><p>Do not output the CPU performance characteristics. Cannot specify with  <code class="docutils literal notranslate"><span class="pre">-tcsv</span></code> option at the same time.</p>
</dd>
<dt>mpi:</dt><dd><p>Output MPI Cost information. When omitted when the target is an MPI program  <code class="docutils literal notranslate"><span class="pre">mpi</span></code> is enabled.</p>
</dd>
<dt>nompi:</dt><dd><p>Do not output MPI Cost information. If omitted if the target is a non-MPI program  <code class="docutils literal notranslate"><span class="pre">nompi</span></code> is enabled.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>-o <em>outfile</em></p></td>
<td><div class="line-block">
<div class="line">Specify the output destination of the profile result. For <em>outfile</em>, specify the output file name as a relative or absolute path, or specify “stdout”.</div>
<div class="line">When this option is omitted,  <code class="docutils literal notranslate"><span class="pre">-ostdout</span></code> option is enabled.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>-p <em>p_no</em></p></td>
<td><div class="line-block">
<div class="line">Specify the process to be output to the profile result.</div>
<div class="line">To <em>p_no</em> , specify one of these : <code class="docutils literal notranslate"><span class="pre">N</span></code>, <code class="docutils literal notranslate"><span class="pre">input=n</span></code>, <code class="docutils literal notranslate"><span class="pre">limit=m</span></code> or  <code class="docutils literal notranslate"><span class="pre">all</span></code>.</div>
<div class="line">When this option is omitted,  <code class="docutils literal notranslate"><span class="pre">-pinput=0</span></code> and  <code class="docutils literal notranslate"><span class="pre">limit=16</span></code> option is enabled. To  <code class="docutils literal notranslate"><span class="pre">-p</span></code>, as comma (,) as devision,  <em>p_no</em> can specified multiply.</div>
<div class="line">For example, it can be like this :  <code class="docutils literal notranslate"><span class="pre">-p3,5,limit=10</span></code>.</div>
</div>
<dl class="simple">
<dt>N … :</dt><dd><p>The information of the process number specified in N is output at the beginning. If the information of the process number specified in N does not exist, ignore the specification. If multiple Ns are specified, they are output in the specified order.</p>
</dd>
<dt>input=n:</dt><dd><p>Reads the number of n process information in descending order of cost. If 0 is specified for n or a value exceeding the number of processes is specified, information for all processes is read. When this sub option is omitted,  <code class="docutils literal notranslate"><span class="pre">input=0</span></code> is enabled. Sub option  <code class="docutils literal notranslate"><span class="pre">input=n</span></code> and sub option  <code class="docutils literal notranslate"><span class="pre">limit=m</span></code> can be specified at the same time.</p>
</dd>
<dt>limit=m:</dt><dd><p>Outputs the number of m process information in descending order of cost. The information of the process that was not output is included in the denominator when calculating the ratio. If m is specified as 0 or a value exceeding the number of input processes, information for all processes is output. When this sub option is omitted,  <code class="docutils literal notranslate"><span class="pre">limit=16</span></code> is enabled.</p>
</dd>
<dt>all:</dt><dd><p>Read all process number information and output in order of highest cost. It is the same of when specified  <code class="docutils literal notranslate"><span class="pre">-pinput=0,limit=0</span></code> option. Neither sub option  <code class="docutils literal notranslate"><span class="pre">input=n</span></code> and  <code class="docutils literal notranslate"><span class="pre">limit=m</span></code>is not specified, this is enabled.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>-t{csv | text}</p></td>
<td><p>Specify output format to the profile result.</p>
<dl class="simple">
<dt>csv:</dt><dd><p>Output as CSV format to profile result. This option cannot specidy at the same time with  <code class="docutils literal notranslate"><span class="pre">-Inocpupa</span></code> option.</p>
</dd>
<dt>text:</dt><dd><p>Output as TEXT format to profile result. If specified this option, does not output CPS performance analizying information even if  <code class="docutils literal notranslate"><span class="pre">-Icpupa</span></code> option is enabled.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</section>
<section id="profile-result">
<h3><span class="section-number">3.1.11.2.6.2. </span>Profile result<a class="headerlink" href="#profile-result" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">The profile result consists of the following statistical information.</div>
<div class="line">ach information can be limited to output with  <code class="docutils literal notranslate"><span class="pre">-I</span></code> option of  <strong class="program">fapppx</strong> command.</div>
<div class="line">For details of each item, please refer to “Profiler User’s Guide”-“3.2.2 Detail of Profile Result”.</div>
</div>
<ul class="simple">
<li><p>Profile data measurement environment information</p></li>
<li><p>Statistical time information</p></li>
<li><p>MPI communication cost information</p></li>
<li><p>CPU performance analizying information</p></li>
</ul>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">3.1.11.2. Advanced Performance Profiler</a><ul>
<li><a class="reference internal" href="#overview">3.1.11.2.1. Overview</a></li>
<li><a class="reference internal" href="#addition-of-measurement-interval-specification-routine">3.1.11.2.2. Addition of measurement interval specification routine</a></li>
<li><a class="reference internal" href="#compiling-linking">3.1.11.2.3. Compiling / Linking</a><ul>
<li><a class="reference internal" href="#about-fortran-translation-options">3.1.11.2.3.1. About Fortran translation options</a></li>
<li><a class="reference internal" href="#about-c-c-translation-options">3.1.11.2.3.2. About C/C++ translation options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#measurement-of-profile-data">3.1.11.2.4. Measurement of profile data</a></li>
<li><a class="reference internal" href="#profiler-option">3.1.11.2.5. Profiler option</a></li>
<li><a class="reference internal" href="#output-profile-result">3.1.11.2.6. Output profile result</a><ul>
<li><a class="reference internal" href="#fapppx-command-option">3.1.11.2.6.1. fapppx command option</a></li>
<li><a class="reference internal" href="#profile-result">3.1.11.2.6.2. Profile result</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="Overview.html"
                          title="previous chapter"><span class="section-number">3.1.11.1. </span>Overview</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="InstantProfiler.html"
                          title="next chapter"><span class="section-number">3.1.11.3. </span>Instant Performance Profiler</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="InstantProfiler.html" title="3.1.11.3. Instant Performance Profiler"
             >next</a></li>
        <li class="right" >
          <a href="Overview.html" title="3.1.11.1. Overview"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Supercomputer Fugaku User Guide －Language and development environment－  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" ><span class="section-number">3. </span>Compilers that generate binaries for compute nodes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" ><span class="section-number">3.1. </span>Fujitsu compiler</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" ><span class="section-number">3.1.11. </span>Profiler</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.1.11.2. </span>Advanced Performance Profiler</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2025, RIKEN Center for Computational Science.
    &nbsp;&nbsp;<a href="https://www.fugaku.r-ccs.riken.jp/en/">Fugaku website Top</a>
    </div>
  </body>
</html>