.. highlight:: none

注意事項
================================

以下にプロファイラ共通の注意事項を示します。なお、各プロファイラ（基本、詳細、CPU解析レポート）の注意事項については、マニュアル「プロファイラ使用手引書」-「第5章注意事項」を参照してください。

翻訳時オプション
--------------------

プログラムの翻訳時に以下のオプションを指定した場合、プロファイラが意図しない挙動となる場合があります。

.. list-table::
   :header-rows: 1
   :widths: 2 7

   * - 翻訳時オプション
     - 説明

   * - \-O0
     - C言語、または、C++プログラムの場合、基本プロファイラで、プログラムのループ情報を計測するためには翻訳時に最適化オプション(\ ``-O1``\ 以上)を指定してください。

   * - \-Nnoline、\-ffj-no-line
     - 翻訳時オプション\ ``-Nnoline``\ 、または、\ ``-ffj-no-line``\ が有効な場合、\ ``fipp``\ コマンドの\ ``-Puserfunc``\ オプションによるコストを正しく計測できません。
       
       このようなプログラムの場合、\ ``-Pnouserfunc``\ オプションを有効にすることでコストを正しく計測できます。
       
       また、翻訳時オプション\ ``-Nnoline``\ 、または、\ ``-ffj-no-line``\が有効な場合、MPIライブラリのコストを正しく計測できません。

   * - \-Ncoarray
     - 翻訳時オプション\ ``-Ncoarray``\ が有効な場合、以下に注意してください。
      
       - ランク番号またはプロセス番号に+1をした値が像番号に相当します。
       - COARRAY機能が利用しているMPIライブラリのコストが計上されることがあります。

   * - \-Klto 、\-flto
     - 翻訳時オプション\ ``-Klto``\ 、または、\ ``-flto``\ が有効な場合、基本プロファイラが出力する以下の情報を保証しません。
       
       - コールグラフ情報

        表示される手続名に、リンク時最適化が内部的に生成した手続名が表示される場合があります。
       
       - ソースコード情報

        各行のコストが正しく表示されない場合があります。

大規模並列プログラムでの長時間・大容量メモリ使用の回避
-------------------------------------------------------

大規模並列ログラムを解析（\ ``fipppx -A``\ 、\ ``fapppx -A``\ 、\ ``fipp -A``\ 、\ ``fapp -A``\ ）する際、プロファイラの解析に長時間かかったり、プロファイラの処理でメモリ不足になる場合があります。

解析処理においては、\ :program:`fapppx`\ コマンドの以下オプションを用いることで、上記の長時間実行とメモリ不足を回避できます。

-p オプション
   解析対象のプロセス数を絞ることで、解析に要するメモリ領域を押さえることができます。

-I オプション
   出力項目を削減し、その分のメモリ使用量を削減できます。

IOを兼用する計算ノードのCPU周波数
---------------------------------

IOを兼用する計算ノード（CN/BIO、CN/SIO、CN/GIO）のCPU周波数は2.2GHzに設定されています。
IOを兼用する計算ノードのCPU周波数は利用者が変更することはできません。

計算ノード（CN）のCPU周波数は2.0GHzに設定されています。性能評価時に留意ください。

CPU周波数につきましては「利用手引書 利用およびジョブ実行編」の「\ `7. 電力制御機能 <https://www.fugaku.r-ccs.riken.jp/doc_root/ja/user_guides/use_latest/PowerControlFunction/index.html>`_\ 」も参照ください。

CPUバインド
------------

| プロファイルデータを計測する場合、スレッドとCPUが１対１の関係になるようにバインドする必要があります。
| バインドされていない場合、計測が正常に行われない場合があります。

CPU性能解析レポートでは次のようなメッセージを出力しレポートは作成されません。::

   paXX.csv : The environment seems to not bind process to core.


CPUバインドするための詳細設定については、次を参照ください。

スレッド並列プログラムを実行するときは、マニュアル「Fortran使用手引書」、「C言語使用手引書」、または「C++言語使用手引書」の「スレッドのCPUバインド」を参照してください。

非スレッド並列かつMPIプログラムを実行(\ :program:`mpiexec`\ で実行)するときは、VCOORDファイルを使ってCPUバインド可能です。
VCOORDファイルの指定方法はマニュアル「MPI使用手引書」の\ ``{ -vcoordfile | --vcoordfile }``\ オプションを参照してください。
VCOORDファイルではすべてのプロセスに対してCPU(コア)数を1(core=1)に指定してください。

非スレッド並列かつ非MPIプログラムを実行するときは、\ :program:`taskset`\ コマンドまたは\ :program:`numactl`\ コマンドでCPUバインド可能です。
詳細は各コマンドのmanページを参照してください。

CPU性能解析レポートのキャッシュミスの比率
------------------------------------------

キャッシュミスの比率については、計測時の誤差やブレの影響により、値が範囲を超える可能性があります。
キャッシュミスの比率が100%を超えた場合は100%に、0%を下回った場合には0%とみなしてください。

マニュアル「プロファイラ使用手引書」の「4.2.2.5.2 Cache(標準レポートおよび詳細レポート)」を参照ください。

