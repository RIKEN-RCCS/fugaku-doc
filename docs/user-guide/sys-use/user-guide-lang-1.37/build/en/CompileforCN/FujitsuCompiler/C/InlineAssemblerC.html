

<!doctype html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3.1.8.5. Inline Assembler &#8212; Supercomputer Fugaku User Guide －Language and development environment－  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bizstyle.css?v=532c1bf3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=f85107c5" />
    
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/bizstyle.js"></script>
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="3.1.9. C++" href="../C%2B%2B/index.html" />
    <link rel="prev" title="3.1.8.4.7.3. Hybrid parallel" href="CSampleProgram%28hybridParallel%29Clang.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../C%2B%2B/index.html" title="3.1.9. C++"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="CSampleProgram%28hybridParallel%29Clang.html" title="3.1.8.4.7.3. Hybrid parallel"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Supercomputer Fugaku User Guide －Language and development environment－  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" ><span class="section-number">3. </span>Compilers that generate binaries for compute nodes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" ><span class="section-number">3.1. </span>Fujitsu compiler</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" accesskey="U"><span class="section-number">3.1.8. </span>C language</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.1.8.5. </span>Inline Assembler</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="inline-assembler">
<span id="inlineassemblerc"></span><h1><span class="section-number">3.1.8.5. </span>Inline Assembler<a class="headerlink" href="#inline-assembler" title="Link to this heading">¶</a></h1>
<p>In C / C ++, specific assembler code described in the source program can be embedded in the output code of the compiler by using the asm statement.</p>
<section id="notes">
<h2><span class="section-number">3.1.8.5.1. </span>Notes<a class="headerlink" href="#notes" title="Link to this heading">¶</a></h2>
<p>Note the following when using the inline assembler (asm statement).</p>
<ol class="arabic simple">
<li><p>There are two types of asm statements (inline assembler): general format and GNU extension format.
The general format is the format defined by the JIS C language standard “The asm keyword” and the C ++ language standard “asm declaration”.</p></li>
<li><p>Assemble files generated by the compiler are assembled by GNU assembler. Refer to the GNU assembler manual for the syntax format and available pseudo-instructions.</p></li>
<li><p>The compiler does not check the contents of the asm statement for correctness. It is necessary for the user to check for errors in the following items.</p>
<ul class="simple">
<li><p>Instruction mnemonic spelling</p></li>
<li><p>Restriction of registers that can be used in instructions and specification of memory addresses</p></li>
<li><p>Correspondence of pseudo-instructions usually used in pairs</p></li>
<li><p>Duplicate symbols such as label names</p></li>
<li><p>ABI compliance (register save / restore, stack use conventions, etc.)</p></li>
</ul>
</li>
<li><p>Delay slots after instructions that change the flow of control (call instructions, ret instructions, branch instructions, etc.) must be explicitly filled in by other instructions.</p></li>
</ol>
</section>
<section id="compile">
<h2><span class="section-number">3.1.8.5.2. </span>Compile<a class="headerlink" href="#compile" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">asm statement (GNU extension format) discribed program translation direction is as following.</div>
<div class="line">It is not required to specify the specific option.</div>
</div>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[_LNlogin]$ </span>fccpx<span class="w"> </span>sample_asm.c<span class="w">            </span><span class="o">(</span>C<span class="o">)</span>
<span class="gp">[_LNlogin]$ </span>FCCpx<span class="w"> </span>sample_asm.cc<span class="w">           </span><span class="o">(</span>C++<span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
<p>The C / C ++ compiler can output assembler code with the  <code class="docutils literal notranslate"><span class="pre">-S</span></code> option.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[_LNlogin]$ </span>fccpx<span class="w">  </span>-S<span class="w">  </span>sample_asm.c<span class="w">         </span><span class="o">(</span>C<span class="o">)</span>
<span class="gp">[_LNlogin]$ </span>FCCpx<span class="w">  </span>-S<span class="w">  </span>sample_asm.cc<span class="w">        </span><span class="o">(</span>C++<span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The C / C ++ compiler does not check the consistency between assembler instructions in asm statements and assembler instructions output by the compiler. The asm statement must be used at the user’s own risk.</p>
</div>
</section>
<section id="asm-statement-general-format">
<h2><span class="section-number">3.1.8.5.3. </span>asm statement (General format)<a class="headerlink" href="#asm-statement-general-format" title="Link to this heading">¶</a></h2>
<p>In C / C ++, any assembler instruction can be output to the assembler code output by the compiler by using the asm statement. In the general form, assembler instructions specified in the asm statement are passed to the assembler commands as is without any processing.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>asm(&quot;Assembler instructions&quot;);
</pre></div>
</div>
</div></blockquote>
</section>
<section id="asm-statement-gnu-expanded-format">
<h2><span class="section-number">3.1.8.5.4. </span>asm statement (GNU expanded format)<a class="headerlink" href="#asm-statement-gnu-expanded-format" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">Operands can be described by C language expressions in assembler instructions in asm statements. By using C language expressions, there is no need to specify the actual hardware location (register or memory location) of the data. Indicates the description method of the asm statement.</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>asm(&quot;Assembly template&quot; : Output operand : Input operand : Destroy register );
</pre></div>
</div>
</div></blockquote>
<p>asm can be described as  __asm__ .</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>__asm__(&quot;Assembly template&quot; : Output operand : Input operand : Destroy register );
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple">
<li><p>Each register description is described as character string data, and the same register description as the following register table is described.</p></li>
<li><p>For the output operand and the input operand, describe one operand description or two or more operand descriptions connected with commas (“,”).</p></li>
<li><p>Operands are numbered starting from 0 (up to 10) through output and input operands. The number is used in the assembler instruction description to specify the position of the operand in the form of “% n” (where n is the number of a single-digit operand).</p></li>
<li><p>For an assembler instruction that does not have an output operand, write two colons (“:”) between the description of the assembler instruction and the description of the input operand.</p></li>
<li><p>To write a multi-line asm statement at a time in an assembly template, insert a line feed character (\ n) and a tab character (\ t).</p></li>
</ol>
</section>
<section id="i-o-operand">
<h2><span class="section-number">3.1.8.5.5. </span>I/O operand<a class="headerlink" href="#i-o-operand" title="Link to this heading">¶</a></h2>
<p>The output operand / input operand consists of a symbol operand name, an operand constraint string, and an operand.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[ Symbol operand name ] &quot;Operand constraint string&quot; (Operand)
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple">
<li><p>In the description of assembler instructions, there is a method of using a symbol operand to specify the position of the operand. Symbol operand names are required only when using symbol operands in assembler instructions. The notation in assembler instructions is `%’`[‘symbol operand name`]’.</p></li>
<li><p>Write a C / C ++ expression in the operand part of ().</p></li>
<li><p>The symbol operand name has no relation to the identifier name in the C / C ++ program outside the asm statement, and even if the same variable name is already used, it is not considered to refer to the same entity.</p></li>
<li><p>It is the user’s responsibility to ensure that the type of the input operand expression is appropriate as the type required for the operands of the assembler instruction.</p></li>
</ol>
</section>
<section id="constraint-character">
<h2><span class="section-number">3.1.8.5.6. </span>Constraint character<a class="headerlink" href="#constraint-character" title="Link to this heading">¶</a></h2>
<p>The following table shows the restriction characters accepted by the C / C ++ compiler.</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Constraint character</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>X</p></td>
<td><p>Indicates any operand.</p></td>
</tr>
<tr class="row-odd"><td><p>g</p></td>
<td><p>Indicates any general-purpose register, memory, or constant.</p></td>
</tr>
<tr class="row-even"><td><p>0,1,2,3,4,5,6,7,8,9</p></td>
<td><p>Indicates the same operand as the one already specified, with the same number as the number.</p></td>
</tr>
<tr class="row-odd"><td><p>[</p></td>
<td><p>Indicates symbol operand name starts.</p></td>
</tr>
<tr class="row-even"><td><p>r</p></td>
<td><p>Indicates general purposeregister.</p></td>
</tr>
<tr class="row-odd"><td><p>f</p></td>
<td><p>Indicates the lower 32 bits of the floating-point register.</p></td>
</tr>
<tr class="row-even"><td><p>m</p></td>
<td><p>Indicates memory.</p></td>
</tr>
<tr class="row-odd"><td><p>p</p></td>
<td><div class="line-block">
<div class="line">Indicates available memory address.</div>
<div class="line">It is used load address direction and push address direction.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>o</p></td>
<td><p>Indicates memory that is as off-set table.</p></td>
</tr>
<tr class="row-odd"><td><p>V</p></td>
<td><p>Indicates memory that is not off-set table.</p></td>
</tr>
<tr class="row-even"><td><p>i</p></td>
<td><p>Indicates an integer constant. The constant value must be fixed at the time of assembly.</p></td>
</tr>
<tr class="row-odd"><td><p>s</p></td>
<td><p>Indicates an integer constant that is unknown at compile time.</p></td>
</tr>
<tr class="row-even"><td><p>E</p></td>
<td><div class="line-block">
<div class="line">Indicates a floating point constant.</div>
<div class="line">It can be used when the floating point format of the target machine and the machine running the compiler match.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>F</p></td>
<td><p>Indicates a floating point constant.</p></td>
</tr>
<tr class="row-even"><td><p>J</p></td>
<td><p>Indicates zero.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Additional information can be specified before the constraint character. If there is no additional information, the constraint character is interpreted as an input-only operand.</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 80.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Attached information</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>=</p></td>
<td><p>Means output only operand.</p></td>
</tr>
<tr class="row-odd"><td><p>+</p></td>
<td><p>Means updated operand (Input and output is both proceeded).</p></td>
</tr>
<tr class="row-even"><td><p>&amp;</p></td>
<td><div class="line-block">
<div class="line">Used as an input operand, but it means that the operand is updated before the instruction group finishes.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="how-to-specify-names-in-assembler-code">
<h2><span class="section-number">3.1.8.5.7. </span>How to specify names in assembler code<a class="headerlink" href="#how-to-specify-names-in-assembler-code" title="Link to this heading">¶</a></h2>
<p>If you want to use different names for variables and functions on the C / C ++ source when outputting to assembler, write the asm description immediately after the declarator. <code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">redefine_extname</span></code> direction is the same meaning with the description method.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="k">asm</span><span class="p">(</span><span class="s">&quot;myfoo&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="how-to-specify-the-specific-register">
<h2><span class="section-number">3.1.8.5.8. </span>How to specify the specific register<a class="headerlink" href="#how-to-specify-the-specific-register" title="Link to this heading">¶</a></h2>
<p>To assign the variable of C/C++ source to the specific hardware register, when defining the variable, specify “register” of the memory area class.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">register</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="k">asm</span><span class="p">(</span><span class="s">&quot;g2&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<ul class="simple">
<li><p>The name specified in the asm description cannot be the same as the register names shown in the following table.</p></li>
<li><p>Names specified as assembler instructions, pseudo-instructions, or special register names in the assembler specifications cannot be specified.</p></li>
</ul>
</div>
</div></blockquote>
</section>
<section id="specification-example-gnu-expanded-format">
<h2><span class="section-number">3.1.8.5.9. </span>Specification example (GNU expanded format)<a class="headerlink" href="#specification-example-gnu-expanded-format" title="Link to this heading">¶</a></h2>
<p>This indicates the Specification example of GNU expanded format.</p>
<ul>
<li><div class="line-block">
<div class="line">Example 1 (Input/Output operand)</div>
<div class="line">Here is an example of an assembler instruction with input and output operands.</div>
</div>
</li>
</ul>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">asm_in1</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">asm_in2</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">asm_out1</span><span class="p">,</span><span class="w"> </span><span class="n">asm_out2</span><span class="p">;</span>
<span class="k">asm</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="s">&quot;asm_op %0,%2</span><span class="se">\n\t</span><span class="s">asm_op %1,%3&quot;</span><span class="w">       </span><span class="c1">// assembler template</span>
<span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;=r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">asm_out1</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;=r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">asm_out2</span><span class="p">)</span><span class="w">      </span><span class="c1">// output operands</span>
<span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">asm_in1</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">asm_in2</span><span class="p">)</span><span class="w">          </span><span class="c1">// input operands</span>
</pre></div>
</div>
<p>Operands are numbered starting from 0 (up to 10) through output and input operands. The number is used in the assembler instruction description to specify the position of the operand in the form of “% n” (where n is the number of a single-digit operand).</p>
<ul class="simple">
<li><p>Input operand  “r” (asm_in1)    → %0</p></li>
<li><p>Input operand  “r” (asm_in2)    → %1</p></li>
<li><p>Output operand  “=r” (asm_out1)  → %2</p></li>
<li><p>Output operand  “=r” (asm_out2)  → %3</p></li>
</ul>
</div></blockquote>
<ul>
<li><div class="line-block">
<div class="line">Example 2 (No Output operand)</div>
<div class="line">In the case of an assembler instruction that has no output operand, two colons (“:”) will be placed consecutively between the description of the assembler instruction and the input operand description.</div>
</div>
</li>
</ul>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">asm_in1</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">asm_in2</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span>
<span class="k">asm</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="s">&quot;asm_op %0</span><span class="se">\t\n</span><span class="s">asm_op %1&quot;</span><span class="w">           </span><span class="c1">// assembler template</span>
<span class="w">  </span><span class="o">:</span><span class="w">                                      </span><span class="c1">// output operands</span>
<span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">asm_in1</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">asm_in2</span><span class="p">)</span><span class="w">        </span><span class="c1">// input operands</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><div class="line-block">
<div class="line">Example 3 (volatile)</div>
<div class="line">By writing volatile immediately after asm, you can instruct the C / C ++ compiler that assembler instructions have serious side effects.</div>
</div>
</li>
</ul>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">asm_out</span><span class="p">;</span>
<span class="k">asm</span><span class="w"> </span><span class="k">volatile</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;asm_op %0&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;=r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">asm_out</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">3.1.8.5. Inline Assembler</a><ul>
<li><a class="reference internal" href="#notes">3.1.8.5.1. Notes</a></li>
<li><a class="reference internal" href="#compile">3.1.8.5.2. Compile</a></li>
<li><a class="reference internal" href="#asm-statement-general-format">3.1.8.5.3. asm statement (General format)</a></li>
<li><a class="reference internal" href="#asm-statement-gnu-expanded-format">3.1.8.5.4. asm statement (GNU expanded format)</a></li>
<li><a class="reference internal" href="#i-o-operand">3.1.8.5.5. I/O operand</a></li>
<li><a class="reference internal" href="#constraint-character">3.1.8.5.6. Constraint character</a></li>
<li><a class="reference internal" href="#how-to-specify-names-in-assembler-code">3.1.8.5.7. How to specify names in assembler code</a></li>
<li><a class="reference internal" href="#how-to-specify-the-specific-register">3.1.8.5.8. How to specify the specific register</a></li>
<li><a class="reference internal" href="#specification-example-gnu-expanded-format">3.1.8.5.9. Specification example (GNU expanded format)</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="CSampleProgram%28hybridParallel%29Clang.html"
                          title="previous chapter"><span class="section-number">3.1.8.4.7.3. </span>Hybrid parallel</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../C%2B%2B/index.html"
                          title="next chapter"><span class="section-number">3.1.9. </span>C++</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../C%2B%2B/index.html" title="3.1.9. C++"
             >next</a></li>
        <li class="right" >
          <a href="CSampleProgram%28hybridParallel%29Clang.html" title="3.1.8.4.7.3. Hybrid parallel"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Supercomputer Fugaku User Guide －Language and development environment－  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" ><span class="section-number">3. </span>Compilers that generate binaries for compute nodes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" ><span class="section-number">3.1. </span>Fujitsu compiler</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" ><span class="section-number">3.1.8. </span>C language</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.1.8.5. </span>Inline Assembler</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2026, RIKEN Center for Computational Science.
    &nbsp;&nbsp;<a href="https://www.fugaku.r-ccs.riken.jp/en/">Fugaku website Top</a>
    </div>
  </body>
</html>