容量設定
================

.. _FirstLayerCapacitySetting:

第1階層ストレージの容量設定
---------------------------

| 1つの計算ノード当たり約87GiBの容量を割り当てられます。
| 1つの計算ノード当たり87GiBの容量を3つの領域に分割して使用できます。

.. figure:: img/CapacitySetting_01.png

各領域の容量の指定方法は下表に示します。

+------------------------------------+-------------------------+-------------------+
| 領域名                             | pjsub --llio オプション | 設定範囲          |
+====================================+=========================+===================+
| ノード内テンポラリ領域             | localtmp-size           | 0MiB～87GiB       |
+------------------------------------+-------------------------+-------------------+
| 共有テンポラリ領域\*1              | sharedtmp-size          | 0MiB～87GiB       |
+------------------------------------+-------------------------+-------------------+
| 第2階層ストレージキャッシュ領域\*1 | なし\*2                 | 128MiB～89406MiB  |
+------------------------------------+-------------------------+-------------------+

\*1 指定する値は、1ノードあたりの値となり、ジョブ内で使用可能な領域サイズは設定値 x 計算ノード数となります。

\*2 87GiB – (localtmp-sizeの設定値 + sharedtmp-sizeの設定値)
    容量設定については、\ `利用手引書-利用およびジョブ実行編- <https://www.fugaku.r-ccs.riken.jp/doc_root/ja/user_guides/use_latest/LayeredStorageAndLLIO/TheSecondLayerStrage.html#volumeofstrage>`_\ の注意も確認ください。 

容量設定例
----------

容量設定の可否の例を以下に示します。設定不可の場合、以下の例のようにpjsubの時点でエラーとなります。

.. code-block:: none

  [ERR.] PJM 0049 pjsub Option argument is invalid. sharedtmp-size + localtmp-size must be less than or equal to 93615751168: --llio sharedtmp-size=XXX, localtmp-size=XXX.

+---------------+----------------+------------------------+----------------------+---------------------------------+--------------+
| 設定値                         | 領域の割当サイズ                                                                | 設定可否     |
+---------------+----------------+------------------------+----------------------+---------------------------------+              +
| localtmp-size | sharedtmp-size | ノード内テンポラリ領域 | 共有テンポラリ領域   | 第2階層ストレージキャッシュ領域 |              |
+===============+================+========================+======================+=================================+==============+
| 0Mi           | 0Mi            | 0MiB                   | 0MiB                 | 87GiB x ノード数                | 設定可能     |
+---------------+----------------+------------------------+----------------------+---------------------------------+--------------+
| 10Gi          | 10Gi           | 10GiB                  | 10GiB x ノード数     | 67GiB x ノード数                | 設定可能     |
+---------------+----------------+------------------------+----------------------+---------------------------------+--------------+
| 87Gi          | 0Mi            | 87GiB                  | 0MiB                 | 128MiB x ノード数               | 設定可能     |
+---------------+----------------+------------------------+----------------------+---------------------------------+--------------+
| **88Gi**      | 0Mi            | **88GiB**              | 0MiB                 | 128MiB x ノード数               | **設定不可** |
+---------------+----------------+------------------------+----------------------+---------------------------------+--------------+
| 0Mi           | 87Gi           | 0MiB                   | 87GiB x ノード数     | 128MiB x ノード数               | 設定可能     |
+---------------+----------------+------------------------+----------------------+---------------------------------+--------------+
| 0Mi           | **88Gi**       | 0MiB                   | **88GiB x ノード数** | 128MiB x ノード数               | **設定不可** |
+---------------+----------------+------------------------+----------------------+---------------------------------+--------------+
| 44Gi          | 44Gi           | 44GiB                  | 44GiB x ノード数     | 128MiB x ノード数               | 設定可能     |
+---------------+----------------+------------------------+----------------------+---------------------------------+--------------+
| **45Gi**      | **44Gi**       | **45GiB**              | **44GiB x ノード数** | 128MiB x ノード数               | **設定不可** |
+---------------+----------------+------------------------+----------------------+---------------------------------+--------------+

LLIOストライプ機能
------------------

ストライプ設定を行うことで、以下の効果が得られます。

- ジョブパラメータで指定したサイズ以上のファイルを作成できます。

- 1つのファイルを複数の第1階層ストレージに分散して格納することにより、ファイルアクセスの帯域幅の増加が期待できます。

対象となる領域は以下のとおりです。

- 共有テンポラリ領域

- 第2階層ストレージキャッシュ領域

4ノードジョブから共有テンポラリ領域=2GiB、ストライプカウント=4、ストライプサイズ1GiBに設定し、4GiBのファイルを書出した例

.. figure:: img/LLIOStripe_01.png


.. list-table:: 
  :header-rows: 1
  :widths: 30 15 50 

  * - pjsub --llioオプション
    - 設定範囲
    - 説明

  * - stripe-count=count 
    - 1～24
    - 第1階層ストレージにファイルを分散配置する際のファイル当たりのストライプ数を指定します。


  * - stripe-size=size 
    - 64KiB～4194240KiB
    - 第1階層ストレージにファイルを分散配置する際のストライプサイズを指定します。


