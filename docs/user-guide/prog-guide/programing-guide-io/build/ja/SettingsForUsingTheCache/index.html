

<!doctype html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
    <link rel="icon" href="/fugaku/docs/img/favicon.ico">

    <title>4. キャッシュを活かした設定 &#8212; プログラミングガイド IO編  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/translations.js"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="5. 排他制御" href="../ExlusionControl/index.html" />
    <link rel="prev" title="3. 容量設定" href="../CapacitySetting/index.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../ExlusionControl/index.html" title="5. 排他制御"
             accesskey="N">次へ</a></li>
        <li class="right" >
          <a href="../CapacitySetting/index.html" title="3. 容量設定"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">プログラミングガイド IO編  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4. </span>キャッシュを活かした設定</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="id1">
<h1><span class="section-number">4. </span>キャッシュを活かした設定<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">¶</a></h1>
<section id="id2">
<h2><span class="section-number">4.1. </span>キャッシュ設定でできること<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">¶</a></h2>
<p>第1階層ストレージでは、ジョブの特性に合わせて、以下のキャッシュ設定を行うことにより、ファイルへの高速アクセスが期待できます。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#secondlayerstoragecache"><span class="std std-ref">第2階層ストレージキャッシュ領域</span></a></p></li>
<li><p><a class="reference internal" href="#cacheincomputenode"><span class="std std-ref">計算ノード内キャッシュ</span></a></p></li>
</ul>
<p>キャッシュを有効に使うことにより、ファイルアクセスの高速化が期待できる機能もあります。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#readahead"><span class="std std-ref">自動先読み機能</span></a></p></li>
<li><p><a class="reference internal" href="#asyncclose"><span class="std std-ref">非同期クローズ</span></a></p></li>
</ul>
</section>
<section id="secondlayerstoragecache">
<span id="id3"></span><h2><span class="section-number">4.2. </span>第2階層ストレージキャッシュ領域<a class="headerlink" href="#secondlayerstoragecache" title="この見出しへのパーマリンク">¶</a></h2>
<p>第2階層ストレージキャッシュ領域に読み込んだファイルをキャッシュするかどうかの設定を行います。</p>
<p>第2階層ストレージ上のファイルに対して複数の読み込みが発生する場合は、キャッシュを有効活用できます。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31.6%" />
<col style="width: 15.8%" />
<col style="width: 52.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>pjsub --llioオプション</p></th>
<th class="head"><p>設定範囲</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sio-read-cache={on|off}</p></td>
<td><p>on or off</p></td>
<td><p>第2階層ストレージキャッシュ領域に読み込んだファイルをキャッシュするかの設定です。</p>
<p>on: キャッシュする。</p>
<p>off: キャッシュしない。</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="cacheincomputenode">
<span id="id4"></span><h2><span class="section-number">4.3. </span>計算ノード内キャッシュ<a class="headerlink" href="#cacheincomputenode" title="この見出しへのパーマリンク">¶</a></h2>
<p>プログラムのメモリ使用量が少ない場合、キャッシュとして設定することにより、ファイルへの高速アクセスが期待できます。</p>
<p>計算ノード内キャッシュを設定するパラメータを以下に示します。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31.6%" />
<col style="width: 15.8%" />
<col style="width: 52.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>pjsub --llioオプション</p></th>
<th class="head"><p>設定範囲</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cn-cache-size=SIZE</p></td>
<td><p>0MiB～32768MiB</p></td>
<td><p>計算ノード内に獲得する第1階層ストレージのキャッシュのサイズを指定します。</p></td>
</tr>
<tr class="row-odd"><td><p>cn-cached-write-size=SIZE</p></td>
<td><p>0MiB～cn-cache-size指定値</p></td>
<td><p>計算ノード内キャッシュの使用有無を切り替える書込みサイズの閾値を指定します。</p></td>
</tr>
<tr class="row-even"><td><p>cn-read-cache={on|off}</p></td>
<td><p>on or off</p></td>
<td><p>第1階層ストレージから読み込んだファイルを計算ノード内キャッシュにキャッシュするかどうかの動作を指定します。</p>
<p>on : 有効にする。</p>
<p>off : 無効にする。</p>
</td>
</tr>
</tbody>
</table>
<section id="cn-cache-size">
<h3><span class="section-number">4.3.1. </span>cn-cache-size<a class="headerlink" href="#cn-cache-size" title="この見出しへのパーマリンク">¶</a></h3>
<p>cn-cache-sizeで、第1階層ストレージのキャッシュ領域のサイズを指定します。
アプリケーションで使用しない領域を第1階層ストレージのキャッシュ領域として使用することで、キャッシュ効果が得られます。</p>
<figure class="align-default">
<img alt="../_images/CompNodeCache01_01.png" src="../_images/CompNodeCache01_01.png" />
</figure>
</section>
<section id="cn-cached-write-size">
<h3><span class="section-number">4.3.2. </span>cn-cached-write-size<a class="headerlink" href="#cn-cached-write-size" title="この見出しへのパーマリンク">¶</a></h3>
<p>cn-cached-write-sizeで指定した閾値を超えないデータは、計算ノードキャッシュを使って書込みを行います。</p>
<figure class="align-default">
<img alt="../_images/CompNodeCache02_01.png" src="../_images/CompNodeCache02_01.png" />
</figure>
<p>閾値を超えるデータは、計算ノードキャッシュを使わずに書込みを行います。</p>
<figure class="align-default">
<img alt="../_images/CompNodeCache03_01.png" src="../_images/CompNodeCache03_01.png" />
</figure>
</section>
<section id="cn-read-cache">
<h3><span class="section-number">4.3.3. </span>cn-read-cache<a class="headerlink" href="#cn-read-cache" title="この見出しへのパーマリンク">¶</a></h3>
<p>cn-read-cacheをonに設定した場合、第1階層ストレージから読み込んだファイル情報をノード内にキャッシュします。</p>
<figure class="align-default">
<img alt="../_images/CompNodeCache04_01.png" src="../_images/CompNodeCache04_01.png" />
</figure>
<p>アプリケーションが読み込むデータ量に対して、十分なキャッシュ領域を確保できない場合、読み込んだデータがキャッシュから追い出され、キャッシュミスの発生により、期待する性能に達しない可能性があります。</p>
</section>
</section>
<section id="readahead">
<span id="id5"></span><h2><span class="section-number">4.4. </span>自動先読み機能<a class="headerlink" href="#readahead" title="この見出しへのパーマリンク">¶</a></h2>
<p>自動先読み機能は、ジョブが階層化ストレージ内の連続した領域を読み込もうとした場合、自動的に計算ノード内キャッシュに先読みすることにより、読み込み処理の高速化が期待できます。</p>
<p>自動先読み機能を有効にする場合、<a class="reference internal" href="#cacheincomputenode"><span class="std std-ref">計算ノード内キャッシュ</span></a> も適切に行う必要があります。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31.6%" />
<col style="width: 15.8%" />
<col style="width: 52.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>pjsub --llioオプション</p></th>
<th class="head"><p>設定範囲</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>auto-readahead={on|off}</p></td>
<td><p>on or off</p></td>
<td><p>自動先読み機能の動作を指定します。</p>
<p>on : 有効にする。</p>
<p>off : 無効にする。</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="asyncclose">
<span id="id6"></span><h2><span class="section-number">4.5. </span>非同期クローズ<a class="headerlink" href="#asyncclose" title="この見出しへのパーマリンク">¶</a></h2>
<p>非同期クローズを有効にすることで、ジョブの経過時間を短縮できます。
同期が必要な場合は、fsync(2)を使用してください。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31.6%" />
<col style="width: 15.8%" />
<col style="width: 52.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>pjsub --llioオプション</p></th>
<th class="head"><p>設定範囲</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>async-close={on|off}</p></td>
<td><p>on or off</p></td>
<td><p>第1階層ストレージおよび第2階層ストレージ上のファイルのクローズを非同期クローズにするかどうかの動作を指定します。</p>
<p>on:  非同期クローズ (ファイルのクローズ時に書出し完了は保証されません)</p>
<p>off: 同期クローズ (ファイルのクローズ時に書出し完了は保証されます)</p>
</td>
</tr>
</tbody>
</table>
<figure class="align-default">
<img alt="../_images/AsynchronousCloseAndSynchronousClose_01.png" src="../_images/AsynchronousCloseAndSynchronousClose_01.png" />
</figure>
</section>
<section id="id7">
<h2><span class="section-number">4.6. </span>未書出し情報ファイル<a class="headerlink" href="#id7" title="この見出しへのパーマリンク">¶</a></h2>
<p>ジョブ終了時に、第2階層ストレージへの書き出しが完了していないファイルの情報の出力先を指定できます。
指定が無い場合は、標準エラー出力に出力されます。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 47.4%" />
<col style="width: 52.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>pjsub --llioオプション</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>uncompleted-fileinfo-path=path</p></td>
<td><p>第2階層ストレージへの書出しが完了していないファイル情報の出力先を指定します。</p></td>
</tr>
</tbody>
</table>
<p>未書出し情報ファイルに関する詳細は、</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.fugaku.r-ccs.riken.jp/doc_root/ja/manuals/fefs/j2ul-2555-01z0.pdf">LLIOユーザーズガイド</a>「2.6 未書出しファイル一覧取得機能」</p></li>
<li><p><a class="reference external" href="https://www.fugaku.r-ccs.riken.jp/doc_root/ja/user_guides/use_latest/LayeredStorageAndLLIO/TheSecondLayerStrage.html#asynccloseandsyncclose">利用手引書-利用およびジョブ実行編-</a></p></li>
</ul>
<p>を参照してください。</p>
</section>
<section id="id9">
<h2><span class="section-number">4.7. </span>LLIO性能情報<a class="headerlink" href="#id9" title="この見出しへのパーマリンク">¶</a></h2>
<p>LLIO性能情報の出力設定方法を以下に示します。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 47.4%" />
<col style="width: 52.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>pjsub --llioオプション</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>perf</p></td>
<td><p>本オプションを指定した際には、LLIO性能情報を出力します。</p></td>
</tr>
<tr class="row-odd"><td><p>perf-path=PATH</p></td>
<td><p>LLIO性能情報の出力パスを設定できます。</p></td>
</tr>
</tbody>
</table>
<p>LLIO性能情報に関する詳細は、<a class="reference external" href="https://www.fugaku.r-ccs.riken.jp/doc_root/ja/manuals/fefs/j2ul-2555-01z0.pdf">LLIOユーザーズガイド</a>の「2.7.2 LLIO性能情報」を参照してください。</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">4. キャッシュを活かした設定</a><ul>
<li><a class="reference internal" href="#id2">4.1. キャッシュ設定でできること</a></li>
<li><a class="reference internal" href="#secondlayerstoragecache">4.2. 第2階層ストレージキャッシュ領域</a></li>
<li><a class="reference internal" href="#cacheincomputenode">4.3. 計算ノード内キャッシュ</a><ul>
<li><a class="reference internal" href="#cn-cache-size">4.3.1. cn-cache-size</a></li>
<li><a class="reference internal" href="#cn-cached-write-size">4.3.2. cn-cached-write-size</a></li>
<li><a class="reference internal" href="#cn-read-cache">4.3.3. cn-read-cache</a></li>
</ul>
</li>
<li><a class="reference internal" href="#readahead">4.4. 自動先読み機能</a></li>
<li><a class="reference internal" href="#asyncclose">4.5. 非同期クローズ</a></li>
<li><a class="reference internal" href="#id7">4.6. 未書出し情報ファイル</a></li>
<li><a class="reference internal" href="#id9">4.7. LLIO性能情報</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="../CapacitySetting/index.html"
                          title="前の章へ"><span class="section-number">3. </span>容量設定</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="../ExlusionControl/index.html"
                          title="次の章へ"><span class="section-number">5. </span>排他制御</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../ExlusionControl/index.html" title="5. 排他制御"
             >次へ</a></li>
        <li class="right" >
          <a href="../CapacitySetting/index.html" title="3. 容量設定"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">プログラミングガイド IO編  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4. </span>キャッシュを活かした設定</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2024, 理化学研究所計算科学研究センター.
    &nbsp;&nbsp;<a href="https://www.fugaku.r-ccs.riken.jp/">Fugaku website Top</a>
    </div>
  </body>
</html>